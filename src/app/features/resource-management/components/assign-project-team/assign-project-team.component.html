<div class="p-4">

    <div class="grid grid-cols-5 gap-4 mt-8">
        <!-- Row 1 -->
        <div>
            <label class="block mb-2 font-semibold">Customer Name*</label>
            <ng-select [(ngModel)]="selectedCustomerId" name="customer" (change)="filterProjects()" [searchable]="true"
                [clearable]="true" class="custom-ng-select">
                <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                    {{ customer.customer_name }}
                </ng-option>
            </ng-select>
        </div>


        <div>
            <label class="block mb-2 font-semibold">Project Name*</label>
            <ng-select [(ngModel)]="selectedProjectId" [disabled]="!selectedCustomerId || filteredProjects.length === 0"
                (change)="onProjectChange($event)" [searchable]="true" [clearable]="true" class="custom-ng-select">
                <ng-option *ngFor="let project of filteredProjects" [value]="project.project_id">
                    {{ project.project_name }}
                </ng-option>
            </ng-select>
        </div>


        <div>
            <label class="block mb-2 font-semibold">Project Manager*</label>
            <input type="text" class="border p-2 w-full rounded-md bg-gray-100"
                [value]="selectedProjectManagerName || 'Not Assigned'" readonly />
        </div>


        <div>
            <label class="block mb-2 font-semibold">Employee Name*</label>
            <ng-select [(ngModel)]="selectedEmployeeId" name="employee" [searchable]="true" [clearable]="true"
                class="custom-ng-select">
                <ng-option [value]="null" disabled hidden>Select Employee</ng-option>
                <ng-option *ngFor="let employee of optionEmployees" [value]="employee.user_id">
                    {{ employee.user_first_name }} {{ employee.user_last_name }}
                </ng-option>
            </ng-select>
        </div>

        <div>
            <label class="block mb-2 font-semibold">Project Role*</label>
            <ng-select [(ngModel)]="selectedProjectRoleId" name="projectRole" [searchable]="true" [clearable]="true"
                class="custom-ng-select">
                <ng-option [value]="null" disabled hidden>Select Project Role</ng-option>
                <ng-option *ngFor="let role of optionProjectRoles" [value]="role.project_role_id">
                    {{ role.project_role_name }}
                </ng-option>
            </ng-select>
        </div>


        <!-- Row 2 -->
        <div>
            <label class="block mb-2 font-semibold">Start Date*</label>
            <input type="date" [(ngModel)]="startDate" name="startDate" class="border p-2 w-full rounded-md">
        </div>

        <div>
            <label class="block mb-2 font-semibold">Tentative End Date*</label>
            <input type="date" [(ngModel)]="tentativeEndDate" name="tentativeEndDate"
                class="border p-2 w-full rounded-md">
        </div>

        <div>
            <label class="block mb-2 font-semibold">Allocation Status*</label>
            <div class="flex gap-4 items-center">
                <span class="text-sm font-medium" [class.text-gray-500]="selectedAllocationStatus === 0"
                    [class.text-green-600]="selectedAllocationStatus === 1">
                    {{ selectedAllocationStatus === 1 ? 'üë®‚Äçüíº Employee' : 'üë• Shadow' }}
                </span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" [checked]="selectedAllocationStatus === 1"
                        (change)="toggleAllocationStatus()">
                    <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer
                peer-checked:after:translate-x-full peer-checked:after:border-white
                after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white
                after:border after:rounded-full after:h-5 after:w-5 after:transition-all
                peer-checked:bg-green-600">
                    </div>
                </label>
            </div>

        </div>

        <div>
            <label class="block mb-2 font-semibold">Allocation Percentage*</label>
            <select [(ngModel)]="selectedAllocationPercentage" name="allocationPercentage"
                class="border p-2 w-full rounded-md" [disabled]="selectedAllocationStatus === 0">
                <option value="" disabled selected>Select Allocation Percentage</option>
                <option *ngFor="let percentage of allocationPercentages" [value]="percentage">
                    {{ percentage }}%
                </option>
            </select>
        </div>
        <!-- Billed Status -->
        <div>
            <label class="block mb-2 font-semibold">Billed Status*</label>
            <div class="flex gap-4 items-center">
                <span class="text-sm font-medium" [class.text-gray-500]="selectedBilledStatus === 0"
                    [class.text-green-600]="selectedBilledStatus === 1">
                    {{ selectedBilledStatus === 1 ? 'üí∞ Billed' : '‚ùå Not Billed' }}
                </span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" [checked]="selectedBilledStatus === 1"
                        (change)="toggleBilledStatus()">
                    <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer
                peer-checked:after:translate-x-full peer-checked:after:border-white
                after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white
                after:border after:rounded-full after:h-5 after:w-5 after:transition-all
                peer-checked:bg-green-600">
                    </div>
                </label>
            </div>
        </div>


        <!-- Billing Percentage -->
        <div>
            <label class="block mb-2 font-semibold">Billing Percentage*</label>
            <select [(ngModel)]="selectedBillingPercentage" name="billingPercentage"
                class="border p-2 w-full rounded-md" [disabled]="selectedBilledStatus === 0">
                <option value="" disabled selected>Select Billing Percentage</option>
                <option *ngFor="let percent of percentageOptions" [value]="percent">{{ percent }}%</option>
            </select>
        </div>


    </div>

    <!-- Submit Button -->
    <div class="mt-6 flex justify-start">
        <button (click)="submitAssignProjectTeam()" class="bg-blue-500 text-white px-4 py-2 rounded m-2">
            Submit
        </button>
    </div>
    <div *ngIf="isEditModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
        (click)="closeEditModal()">
        <div class="bg-white p-6 rounded-lg w-1/2" (click)="$event.stopPropagation()">
            <h3 class="text-xl font-semibold mb-4">Edit Assign Team</h3>
            <form #editAssignTeamForm="ngForm"
                (ngSubmit)="updateAssignTeam(editAssignTeamForm); $event.preventDefault()">
                <div class="grid grid-cols-4 gap-4">
                    <!-- Customer Name -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Customer Name*</label>
                        <ng-select [(ngModel)]="editSelectedCustomerId" name="editCustomer" [searchable]="true"
                            [clearable]="true" class="custom-ng-select" required>
                            <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                                {{ customer.customer_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Project Name -->

                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Project Name*</label>
                        <ng-select [(ngModel)]="editSelectedProjectId" name="editProject" [searchable]="true"
                            [clearable]="true" [disabled]="!editSelectedCustomerId || filteredProjects.length === 0"
                            class="custom-ng-select" required>
                            <ng-option *ngFor="let project of filteredProjects" [value]="project.project_id">
                                {{ project.project_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Employee Name -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Employee Name*</label>
                        <ng-select [(ngModel)]="editSelectedEmployeeId" name="editEmployee" [searchable]="true"
                            [clearable]="true" class="custom-ng-select" required>
                            <ng-option *ngFor="let employee of optionEmployees" [value]="employee.user_id">
                                {{ employee.user_first_name }} {{ employee.user_last_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Project Role -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Project Role*</label>
                        <ng-select [(ngModel)]="editSelectedProjectRoleId" name="editProjectRole" [searchable]="true"
                            [clearable]="true" class="custom-ng-select" required>
                            <ng-option *ngFor="let role of optionProjectRoles" [value]="role.project_role_id">
                                {{ role.project_role_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Start Date -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Start Date*</label>
                        <input type="date" [(ngModel)]="editStartDate" name="editStartDate"
                            class="border p-2 w-full rounded-md" required>
                    </div>

                    <!-- Tentative End Date -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Tentative End Date*</label>
                        <input type="date" [(ngModel)]="editTentativeEndDate" name="editTentativeEndDate"
                            class="border p-2 w-full rounded-md">
                    </div>

                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Allocation Status*</label>
                        <div class="flex gap-4 items-center">
                            <span class="text-sm font-medium" [class.text-gray-500]="editSelectedAllocationStatus === 0"
                                [class.text-green-600]="editSelectedAllocationStatus === 1">
                                {{ editSelectedAllocationStatus === 1 ? 'üë®‚Äçüíº Employee' : 'üë• Shadow' }}
                            </span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer"
                                    [checked]="editSelectedAllocationStatus === 1"
                                    (change)="toggleEditAllocationStatus()">
                                <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer
                                     peer-checked:after:translate-x-full peer-checked:after:border-white
                                     after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white
                                     after:border after:rounded-full after:h-5 after:w-5 after:transition-all
                                     peer-checked:bg-green-600">
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Allocation Percentage -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Allocation Percentage*</label>
                        <select [(ngModel)]="editSelectedAllocationPercentage" name="editAllocationPercentage"
                            [disabled]="editSelectedAllocationStatus === 0" class="border p-2 w-full rounded-md"
                            [required]="editSelectedAllocationStatus === 1">
                            <option *ngIf="editSelectedAllocationStatus === 1" value="" disabled selected>Select
                                Allocation Percentage</option>
                            <option *ngFor="let percentage of allocationPercentages" [value]="percentage"
                                [selected]="editSelectedAllocationStatus === 0 && percentage === 0">
                                {{ percentage }}%
                            </option>
                        </select>
                    </div>

                    <!-- Billed Status -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Billed Status*</label>
                        <div class="flex gap-4 items-center">
                            <span class="text-sm font-medium" [class.text-gray-500]="editSelectedBilledStatus === 0"
                                [class.text-green-600]="editSelectedBilledStatus === 1">
                                {{ editSelectedBilledStatus === 1 ? 'üí∞ Billed' : '‚ùå Not Billed' }}
                            </span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" [checked]="editSelectedBilledStatus === 1"
                                    (change)="toggleEditBilledStatus()" [disabled]="editSelectedAllocationStatus === 0">
                                <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer
                 peer-checked:after:translate-x-full peer-checked:after:border-white
                 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white
                 after:border after:rounded-full after:h-5 after:w-5 after:transition-all
                 peer-checked:bg-green-600" [class.bg-gray-200]="editSelectedAllocationStatus === 0"
                                    [class.cursor-not-allowed]="editSelectedAllocationStatus === 0">
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Billing Percentage -->
                    <div class="form-group">
                        <label class="block mb-2 font-semibold">Billing Percentage*</label>
                        <select [(ngModel)]="editSelectedBillingPercentage" name="editBillingPercentage"
                            [disabled]="editSelectedBilledStatus === 0 || editSelectedAllocationStatus === 0"
                            class="border p-2 w-full rounded-md" [required]="editSelectedBilledStatus === 1">
                            <option *ngIf="editSelectedBilledStatus === 1" value="" disabled selected>Select Billing
                                Percentage</option>
                            <option *ngFor="let percent of percentageOptions" [value]="percent">{{ percent }}%</option>
                        </select>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="mt-4">
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">
                        Update
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="rounded-lg w-full overflow-x-auto">
        <!-- Filter Section -->
        <div class="min-w-max">

            <div
                class="flex flex-wrap items-center justify-between gap-x-2 gap-y-4 mb-4 py-2 bg-gray-50 rounded shadow-sm w-full">

                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Customer</label>
                    <ng-select [(ngModel)]="customerNameFilter" (change)="applyFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true" [searchable]="true">
                        <ng-option [value]="">Select Customer</ng-option>
                        <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                            {{ customer.customer_name }}
                        </ng-option>
                    </ng-select>
                </div>


                <!-- Project Name Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Project</label>
                    <ng-select [(ngModel)]="projectNameFilter" (change)="applyFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true" [searchable]="true">
                        <ng-option [value]="">Select Project</ng-option>
                        <ng-option *ngFor="let project of optionProjects" [value]="project.project_id">
                            {{ project.project_name }}
                        </ng-option>
                    </ng-select>
                </div>

                <!-- Employee Name Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Employee</label>
                    <ng-select [(ngModel)]="employeeNameFilter" (change)="applyFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true" [searchable]="true">
                        <ng-option [value]="">Select Employee</ng-option>
                        <ng-option *ngFor="let employee of optionEmployees" [value]="employee.user_id">
                            {{ employee.user_first_name }} {{ employee.user_last_name }}
                        </ng-option>
                    </ng-select>
                </div>

                <!-- Project Role Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Project Role</label>
                    <ng-select [(ngModel)]="projectRoleFilter" (change)="applyFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true" [searchable]="true">
                        <ng-option [value]="">Select Project Role</ng-option>
                        <ng-option *ngFor="let role of optionProjectRoles" [value]="role.project_role_id">
                            {{ role.project_role_name }}
                        </ng-option>
                    </ng-select>
                </div>

                <!-- Project Manager Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Project Manager</label>
                    <ng-select [(ngModel)]="projectManagerFilter" (change)="applyFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true" [searchable]="true">
                        <ng-option [value]="null" disabled hidden>Select Project Manager</ng-option>
                        <ng-option *ngFor="let manager of optionProjectManagers" [value]="manager.user_id">
                            {{ manager.user_first_name }} {{ manager.user_last_name }}
                        </ng-option>
                    </ng-select>
                </div>

                <!-- Start Date Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Start Date</label>

                    <input type="date" [(ngModel)]="startDateFilter" (change)="applyFilters()"
                        class="text-xs border border-gray-300 rounded px-1 py-1 w-full focus:outline-none focus:ring focus:ring-blue-300" />
                    <button *ngIf="startDateFilter" (click)="clearFilter('startDateFilter')"
                        class="absolute inset-y-0 right-0 px-2 flex items-center text-gray-500 hover:text-gray-700">
                        √ó
                    </button>
                </div>

                <!-- End Date Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">End Date</label>

                    <input type="date" [(ngModel)]="endDateFilter" (change)="applyFilters()"
                        class="text-xs border border-gray-300 rounded px-1 py-1 w-full focus:outline-none focus:ring focus:ring-blue-300" />
                    <button *ngIf="endDateFilter" (click)="clearFilter('endDateFilter')"
                        class="absolute inset-y-0 right-0 px-2 flex items-center text-gray-500 hover:text-gray-700">
                        √ó
                    </button>
                </div>

                <!-- Allocation Status Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Allocation Status</label>
                    <ng-select [(ngModel)]="allocationStatusFilter" (change)="applyFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true">
                        <ng-option [value]="null">Select Allocation Status</ng-option>
                        <ng-option [value]="1">Employee</ng-option>
                        <ng-option [value]="0">Shadow</ng-option>
                    </ng-select>
                </div>

                <!-- Allocation % Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Allocation %</label>

                    <input type="number" [(ngModel)]="allocationPercentageFilter" placeholder="Allocation %"
                        (input)="applyFilters()"
                        class="text-xs border border-gray-300 rounded px-1 py-1 w-full focus:outline-none focus:ring focus:ring-blue-300" />
                    <button *ngIf="allocationPercentageFilter !== null"
                        (click)="clearFilter('allocationPercentageFilter')"
                        class="absolute inset-y-0 right-0 px-2 flex items-center text-gray-500 hover:text-gray-700">
                        √ó
                    </button>
                </div>

                <!-- Billed Status Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Billed Status</label>
                    <ng-select [(ngModel)]="billedStatusFilter" (change)="applyFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true">
                        <ng-option [value]="null">Select Billed Status</ng-option>
                        <ng-option [value]="1">Billed</ng-option>
                        <ng-option [value]="0">Not Billed</ng-option>
                    </ng-select>
                </div>

                <!-- Billing % Filter -->
                <div class="relative flex-grow">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Billing %</label>

                    <input type="number" [(ngModel)]="billingPercentageFilter" placeholder="Billing %"
                        (input)="applyFilters()"
                        class="text-xs border border-gray-300 rounded px-1 py-1 w-full focus:outline-none focus:ring focus:ring-blue-300" />
                    <button *ngIf="billingPercentageFilter !== null" (click)="clearFilter('billingPercentageFilter')"
                        class="absolute inset-y-0 right-0 px-2 flex items-center text-gray-500 hover:text-gray-700">
                        √ó
                    </button>
                </div>

                <!-- Clear All Filters -->
                <button (click)="clearFilters()"
                    class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none flex-grow-0">Clear
                    All Filters</button>
            </div>
        </div>
        <div class="rounded-lg w-full inline-block whitespace-nowrap">
            <table class="w-full border-collapse border border-gray-300 mt-4">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="border p-2">Sr No</th>
                        <th class="border p-2">Customer Name</th>
                        <th class="border p-2">Project Name</th>
                        <th class="border p-2">Employee Name</th>
                        <th class="border p-2">Project Role</th>
                        <th class="border p-2">Project Manager</th>
                        <th class="border p-2">Start Date</th>
                        <th class="border p-2">End Date</th>
                        <th class="border p-2">Allocation Status</th>
                        <th class="border p-2">Allocation %</th>
                        <th class="border p-2">Billed Status</th>
                        <th class="border p-2">Billing Percentag</th>
                        <th class="border p-2">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let team of paginatedAssignedProjectTeams; let i = index" class="hover:bg-gray-50">
                        <td class="border p-2">{{ i + 1 }}</td>
                        <td class="border p-2">{{ team.customer_name }}</td>
                        <td class="border p-2">{{ team.project_name }}</td>
                        <td class="border p-2">{{ team.employee_name }}</td>
                        <td class="border p-2">{{ team.project_role_name }}</td>
                        <td class="border p-2">{{ team.project_manager_name }}</td>
                        <td class="border p-2">{{ team.start_date | date:'dd-MMM-yyyy' }}</td>
                        <td class="border p-2">{{ team.end_date | date:'dd-MMM-yyyy' }}</td>
                        <td class="border p-2">
                            {{ team.allocation_status === 1 ? 'Employee' : 'Shadow' }}
                        </td>
                        <td class="border p-2">{{ team.allocation_percentage }}%</td>
                        <td class="border p-2">{{ team.billed_status ? 'Billed' : 'Not Billed' }}</td>
                        <td class="border p-2">{{ team.billing_percentage }}%</td>
                        <td class="border p-2">
                            <button class="bg-blue-500 text-white px-2 py-1 rounded mr-2"
                                (click)="openEditModal(team)">Edit</button>
                            <button class="bg-red-500 text-white px-2 py-1 rounded"
                                (click)="deleteAssignProjectTeam(team.project_team_id)">
                                Delete
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
    <div class="flex items-center justify-center mt-4 space-x-1">
        <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1"
            class="px-3 py-1 border rounded-md">
            Previous
        </button>

        <button *ngIf="currentPage > 3" (click)="changePage(1)" class="px-3 py-1 border rounded-md">
            1
        </button>

        <span *ngIf="currentPage > 4" class="px-2">...</span>

        <button *ngFor="let page of getVisiblePageNumbers()" (click)="changePage(page)"
            [class.bg-blue-500]="currentPage === page" class="px-3 py-1 border rounded-md">
            {{ page }}
        </button>

        <span *ngIf="currentPage < totalPages - 3" class="px-2">...</span>

        <button *ngIf="currentPage < totalPages - 2" (click)="changePage(totalPages)"
            class="px-3 py-1 border rounded-md">
            {{ totalPages }}
        </button>

        <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages"
            class="px-3 py-1 border rounded-md">
            Next
        </button>
    </div>
</div>