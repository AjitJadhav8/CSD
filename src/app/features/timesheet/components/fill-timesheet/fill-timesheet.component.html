<div class="p-4">
    <!-- Button to open the modal -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">

        <div class="mb-6 pb-4 border-b border-gray-200 flex justify-between items-center">
            <div>
                <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                            clip-rule="evenodd" />
                    </svg>
                    Fill Timesheet
                </h3>
                <p class="text-xs text-gray-500 mt-1">Fill all required fields (*) to submit your timesheet</p>
            </div>

            <div class="flex items-center">
                <div class="text-right">
                    <div class="flex items-center justify-end" [ngClass]="{
                        'text-red-600': calculateTotalHours() < 6,
                        'text-orange-500': calculateTotalHours() >= 6 && calculateTotalHours() <= 8,
                        'text-green-600': calculateTotalHours() > 8
                    }">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="font-medium">
                            {{ calculateTotalTime().hours }}h {{ calculateTotalTime().minutes }}m
                        </span>
                    </div>
                    <div class="text-xs mt-1" [ngClass]="{
                        'text-red-500': calculateTotalHours() < 6,
                        'text-orange-500': calculateTotalHours() >= 6 && calculateTotalHours() <= 8,
                        'text-green-500': calculateTotalHours() > 8
                    }">
                        {{ getHoursStatusText() }}
                    </div>
                </div>
            </div>
        </div>



        <form #timesheetForm="ngForm" (ngSubmit)="submitTimesheet(timesheetForm); $event.preventDefault()">
            <div class="grid grid-cols-5 gap-4 mb-4">
                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Filling Timesheet for*</label>
                    <input type="date"
                        class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                        [(ngModel)]="selectedDate" (change)="onDateChange()" [min]="minDate" [max]="maxDate"
                        name="selectedDate" #selectedDateInput="ngModel" required
                        [ngClass]="{'border-red-500': (selectedDateInput.invalid && selectedDateInput.touched) || (timesheetForm.submitted && selectedDateInput.invalid)}">
                    <span class="text-xs text-red-500"
                        *ngIf="(selectedDateInput.invalid && selectedDateInput.touched) || (timesheetForm.submitted && selectedDateInput.invalid)">
                        Required
                    </span>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Customer*</label>
                    <ng-select class="text-xs custom-ng-select" [(ngModel)]="selectedCustomer" name="selectedCustomer"
                        #selectedCustomerInput="ngModel" (change)="onCustomerChange()" required
                        [ngClass]="{'border-red-500': (selectedCustomerInput.invalid && selectedCustomerInput.touched) || (timesheetForm.submitted && selectedCustomerInput.invalid)}">
                        <ng-option [value]="" disabled selected>Select Customer</ng-option>
                        <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                            {{ customer.customer_name }}
                        </ng-option>
                    </ng-select>
                    <span class="text-xs text-red-500"
                        *ngIf="(selectedCustomerInput.invalid && selectedCustomerInput.touched) || (timesheetForm.submitted && selectedCustomerInput.invalid)">
                        Required
                    </span>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Project*</label>
                    <ng-select class="text-xs custom-ng-select" [(ngModel)]="selectedProject" name="selectedProject"
                        #selectedProjectInput="ngModel" [disabled]="!selectedCustomer" (change)="onProjectChange()"
                        required
                        [ngClass]="{'border-red-500': (selectedProjectInput.invalid && selectedProjectInput.touched) || (timesheetForm.submitted && selectedProjectInput.invalid)}">
                        <ng-option [value]="" disabled selected>Select Project</ng-option>
                        <ng-option *ngFor="let project of filterOptionProjects" [value]="project.project_id">
                            {{ project.project_name }}
                        </ng-option>
                    </ng-select>
                    <span class="text-xs text-red-500"
                        *ngIf="(selectedProjectInput.invalid && selectedProjectInput.touched) || (timesheetForm.submitted && selectedProjectInput.invalid)">
                        Required
                    </span>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Deliverable*</label>
                    <ng-select class="text-xs custom-ng-select" [(ngModel)]="selectedDeliverable"
                        name="selectedDeliverable" #selectedDeliverableInput="ngModel" [disabled]="!selectedProject"
                        (change)="onDeliverableChange()" required
                        [ngClass]="{'border-red-500': (selectedDeliverableInput.invalid && selectedDeliverableInput.touched) || (timesheetForm.submitted && selectedDeliverableInput.invalid)}">
                        <ng-option [value]="" disabled selected>Select Deliverable</ng-option>
                        <ng-option *ngFor="let deliverable of filterOptionProjectDeliverables"
                            [value]="deliverable.pd_id">
                            {{ deliverable.project_deliverable_name }}
                        </ng-option>
                    </ng-select>
                    <span class="text-xs text-red-500"
                        *ngIf="(selectedDeliverableInput.invalid && selectedDeliverableInput.touched) || (timesheetForm.submitted && selectedDeliverableInput.invalid)">
                        Required
                    </span>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Phase*</label>
                    <ng-select class="text-xs custom-ng-select" [(ngModel)]="selectedPhase" name="selectedPhase"
                        #selectedPhaseInput="ngModel" [disabled]="!selectedDeliverable" required
                        [ngClass]="{'border-red-500': (selectedPhaseInput.invalid && selectedPhaseInput.touched) || (timesheetForm.submitted && selectedPhaseInput.invalid)}">
                        <ng-option [value]="" disabled selected>Select Phase</ng-option>
                        <ng-option *ngFor="let phase of filterOptionPhases" [value]="phase.phase_id">
                            {{ phase.project_phase_name }}
                        </ng-option>
                    </ng-select>
                    <span class="text-xs text-red-500"
                        *ngIf="(selectedPhaseInput.invalid && selectedPhaseInput.touched) || (timesheetForm.submitted && selectedPhaseInput.invalid)">
                        Required
                    </span>
                </div>
            </div>

            <div class="grid grid-cols-5 gap-4 mb-4">


                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Hours*</label>
                    <select
                        class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                        [(ngModel)]="selectedHours" name="selectedHours" #selectedHoursInput="ngModel" required
                        [ngClass]="{'border-red-500': (selectedHoursInput.invalid && selectedHoursInput.touched) || (timesheetForm.submitted && selectedHoursInput.invalid)}">
                        <option *ngFor="let hour of hoursList" [value]="hour">{{ hour }}</option>
                    </select>
                    <span class="text-xs text-red-500"
                        *ngIf="(selectedHoursInput.invalid && selectedHoursInput.touched) || (timesheetForm.submitted && selectedHoursInput.invalid)">
                        Required
                    </span>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Minutes*</label>
                    <select
                        class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                        [(ngModel)]="selectedMinutes" name="selectedMinutes" #selectedMinutesInput="ngModel" required
                        [ngClass]="{'border-red-500': (selectedMinutesInput.invalid && selectedMinutesInput.touched) || (timesheetForm.submitted && selectedMinutesInput.invalid)}">
                        <option *ngFor="let minute of minutesList" [value]="minute">{{ minute }}</option>
                    </select>
                    <span class="text-xs text-red-500"
                        *ngIf="(selectedMinutesInput.invalid && selectedMinutesInput.touched) || (timesheetForm.submitted && selectedMinutesInput.invalid)">
                        Required
                    </span>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-gray-600">Task Status*</label>
                    <div class="flex items-center space-x-3">
                        <span class="text-xs font-medium" [class.text-gray-500]="selectedTaskStatus === 0"
                            [class.text-green-600]="selectedTaskStatus === 1">
                            {{ selectedTaskStatus === 1 ? 'âœ… Completed' : 'âš  In Progress' }}
                        </span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" [checked]="selectedTaskStatus === 1"
                                (change)="toggleTaskStatus()">
                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer
                              peer-checked:after:translate-x-full peer-checked:after:border-white
                              after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white
                              after:border after:rounded-full after:h-5 after:w-5 after:transition-all
                              peer-checked:bg-green-600">
                            </div>
                        </label>
                    </div>
                    <span class="text-xs text-red-500" *ngIf="selectedTaskStatus === null && timesheetForm.submitted">
                        Required
                    </span>
                </div>

                <div class="space-y-1 col-span-2">
                    <label class="text-xs font-medium text-gray-600">Task Description*</label>
                    <textarea
                        class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                        [(ngModel)]="taskDescription" name="taskDescription" #taskDescriptionInput="ngModel" rows="3"
                        required
                        [ngClass]="{'border-red-500': (taskDescriptionInput.invalid && taskDescriptionInput.touched) || (timesheetForm.submitted && taskDescriptionInput.invalid)}"></textarea>
                    <span class="text-xs text-red-500"
                        *ngIf="(taskDescriptionInput.invalid && taskDescriptionInput.touched) || (timesheetForm.submitted && taskDescriptionInput.invalid)">
                        Required
                    </span>
                </div>


            </div>

            <!-- Submit Button -->
            <div class="mt-6 flex justify-center">
                <button type="submit"
                    class="flex items-center text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                            clip-rule="evenodd" />
                    </svg>
                    Submit Timesheet
                </button>
            </div>
        </form>
    </div>


    <!-- ðŸ”¹ Timesheet Table Section -->
    <div class="rounded-lg w-full overflow-x-auto p-2 bg-white shadow-sm border border-gray-200 m-4">
        <div class="rounded-lg w-full inline-block whitespace-nowrap">
            <table class="min-w-full text-xs border-collapse">
                <thead>
                    <tr class="bg-gray-50">
                        <th
                            class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-200 text-center bg-gray-50">
                            #</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Customer</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Project</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Deliverable</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Phase</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Task</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Time</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Status</th>
                        <th class="px-1 py-1 border border-gray-200 text-center">Date</th>
                        <th class="sticky right-0 px-1 py-1 border border-gray-200 text-center bg-gray-50">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let timesheet of timesheetData; let i = index" class="hover:bg-gray-50">
                        <td
                            class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                            {{ i + 1 }}</td>
                        <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.customer_name || '-' }}
                        </td>
                        <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.project_name || '-' }}
                        </td>
                        <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.project_deliverable_name
                            || '-' }}</td>
                        <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.project_phase_name || '-'
                            }}</td>
                        <td class="px-1 py-1 border border-gray-300 text-center">
                            <div class="group relative inline-block">
                                <span class="truncate max-w-[80px] inline-block">{{ timesheet.task_description || '-'
                                    }}</span>
                                <div *ngIf="timesheet.task_description"
                                    class="absolute z-20 hidden group-hover:block w-64 px-1 py-1 mb-2 text-xs text-gray-700 bg-white rounded shadow-lg border border-gray-300">
                                    {{ timesheet.task_description }}
                                </div>
                            </div>
                        </td>
                        <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.hours }}h {{
                            timesheet.minutes }}m</td>
                        <td class="px-1 py-1 border border-gray-300 text-center">
                            <span [class.text-green-600]="timesheet.task_status === 1"
                                [class.text-yellow-600]="timesheet.task_status === 0">
                                {{ timesheet.task_status === 0 ? 'In Progress' : 'Completed' }}
                            </span>
                        </td>
                        <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.timesheet_date |
                            date:'dd-MMM-yyyy' }}</td>
                        <td
                            class="sticky right-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">

                            <button (click)="retainTimesheetEntry(timesheet)"
                                class="text-blue-600 hover:text-blue-800 p-1 mr-1"
                                title="Retain this entry to fill again">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
                                </svg>
                            </button>

                            <button (click)="openEditModal(timesheet)"
                                class="text-green-600 hover:text-green-800 p-1 mr-1"
                                [disabled]="!isTimesheetEditable(timesheet.timesheet_date)"
                                [class.opacity-50]="!isTimesheetEditable(timesheet.timesheet_date)"
                                [class.cursor-not-allowed]="!isTimesheetEditable(timesheet.timesheet_date)"
                                [title]="!isTimesheetEditable(timesheet.timesheet_date) ? 'Editing is only allowed within 24 hours of creation' : ''">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </button>

                            <button (click)="deleteTimesheet(timesheet.timesheet_id)"
                                class="text-red-600 hover:text-red-800 p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!-- Edit Timesheet Modal -->
    <!-- <div *ngIf="isEditModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
      (click)="closeEditModal()">
      <div class="bg-white p-6 rounded-lg w-1/2" (click)="$event.stopPropagation()">
          <h3 class="text-xl font-semibold mb-4">Edit Timesheet</h3>
          <form #editTimesheetForm="ngForm" (ngSubmit)="updateTimesheet(editTimesheetForm); $event.preventDefault()">
              <div class="grid grid-cols-4 gap-4">
                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Date*</label>
                      <input type="date" class="border p-2 w-full rounded-md" [(ngModel)]="editSelectedDate"
                          name="editSelectedDate" #editSelectedDateInput="ngModel" required>
                      <span class="text-red-500 text-sm"
                          *ngIf="editSelectedDateInput.invalid && editSelectedDateInput.touched">
                          Date is required
                      </span>
                  </div>

                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Customer*</label>
                      <ng-select class="custom-ng-select" [(ngModel)]="editSelectedCustomer"
                          name="editSelectedCustomer" #editSelectedCustomerInput="ngModel"
                          (change)="onEditCustomerChange()" required>
                          <ng-option [value]="" disabled selected>Select Customer</ng-option>
                          <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                              {{ customer.customer_name }}
                          </ng-option>
                      </ng-select>
                      <span class="text-red-500 text-sm"
                          *ngIf="editSelectedCustomerInput.invalid && editSelectedCustomerInput.touched">
                          Customer is required
                      </span>
                  </div>
                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Project*</label>
                      <ng-select class="custom-ng-select" [(ngModel)]="editSelectedProject" name="editSelectedProject"
                          #editSelectedProjectInput="ngModel" [disabled]="!editSelectedCustomer"
                          (change)="onEditProjectChange()" required>
                          <ng-option [value]="" disabled selected>Select Project</ng-option>
                          <ng-option *ngFor="let project of filterOptionProjects" [value]="project.project_id">
                              {{ project.project_name }}
                          </ng-option>
                      </ng-select>
                      <span class="text-red-500 text-sm"
                          *ngIf="editSelectedProjectInput.invalid && editSelectedProjectInput.touched">
                          Project is required
                      </span>
                  </div>

                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Deliverable*</label>
                      <ng-select class="custom-ng-select" [(ngModel)]="editSelectedDeliverable"
                          name="editSelectedDeliverable" #editSelectedDeliverableInput="ngModel"
                          [disabled]="!editSelectedProject" (change)="onEditDeliverableChange()" required>
                          <ng-option [value]="" disabled selected>Select Deliverable</ng-option>
                          <ng-option *ngFor="let deliverable of filterOptionProjectDeliverables"
                              [value]="deliverable.pd_id">
                              {{ deliverable.project_deliverable_name }}
                          </ng-option>
                      </ng-select>
                      <span class="text-red-500 text-sm"
                          *ngIf="editSelectedDeliverableInput.invalid && editSelectedDeliverableInput.touched">
                          Deliverable is required
                      </span>
                  </div>

                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Phase*</label>
                      <ng-select class="custom-ng-select" [(ngModel)]="editSelectedPhase" name="editSelectedPhase"
                          #editSelectedPhaseInput="ngModel" [disabled]="!editSelectedDeliverable" required>
                          <ng-option [value]="" disabled selected>Select Phase</ng-option>
                          <ng-option *ngFor="let phase of filterOptionPhases" [value]="phase.phase_id">
                              {{ phase.project_phase_name }}
                          </ng-option>
                      </ng-select>
                      <span class="text-red-500 text-sm"
                          *ngIf="editSelectedPhaseInput.invalid && editSelectedPhaseInput.touched">
                          Phase is required
                      </span>
                  </div>

                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Hours*</label>
                      <select class="border p-2 w-full rounded-md" [(ngModel)]="editSelectedHours"
                          name="editSelectedHours" #editSelectedHoursInput="ngModel" required>
                          <option *ngFor="let hour of hoursList" [value]="hour">{{ hour }}</option>
                      </select>
                      <span class="text-red-500 text-sm"
                          *ngIf="editSelectedHoursInput.invalid && editSelectedHoursInput.touched">
                          Hours are required
                      </span>
                  </div>

                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Minutes*</label>
                      <select class="border p-2 w-full rounded-md" [(ngModel)]="editSelectedMinutes"
                          name="editSelectedMinutes" #editSelectedMinutesInput="ngModel" required>
                          <option *ngFor="let minute of minutesList" [value]="minute">{{ minute }}</option>
                      </select>
                      <span class="text-red-500 text-sm"
                          *ngIf="editSelectedMinutesInput.invalid && editSelectedMinutesInput.touched">
                          Minutes are required
                      </span>
                  </div>

                  <div class="form-group">
                      <label class="block mb-2 font-semibold">Task Status*</label>
                      <div class="flex items-center space-x-3">
                          <span class="text-sm font-medium" [class.text-gray-500]="editSelectedTaskStatus === 0"
                              [class.text-green-600]="editSelectedTaskStatus === 1">
                              {{ editSelectedTaskStatus === 1 ? 'âœ… Completed' : 'âš  In Progress' }}
                          </span>
                          <label class="relative inline-flex items-center cursor-pointer">
                              <input type="checkbox" class="sr-only peer" [(ngModel)]="editSelectedTaskStatus"
                                  name="editSelectedTaskStatus" (ngModelChange)="onEditTaskStatusChange($event)">
                              <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer
                                     peer-checked:after:translate-x-full peer-checked:after:border-white
                                     after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white
                                     after:border after:rounded-full after:h-5 after:w-5 after:transition-all
                                     peer-checked:bg-green-600">
                              </div>
                          </label>
                      </div>
                  </div>

                  <div class="form-group col-span-4">
                      <label class="block mb-2 font-semibold">Task Description*</label>
                      <textarea class="border p-2 w-full rounded-md" [(ngModel)]="editTaskDescription"
                          name="editTaskDescription" #editTaskDescriptionInput="ngModel" rows="3" required></textarea>
                      <span class="text-red-500 text-sm"
                          *ngIf="editTaskDescriptionInput.invalid && editTaskDescriptionInput.touched">
                          Task Description is required
                      </span>
                  </div>
              </div>

              <div class="mt-4">
                  <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">
                      Update
                  </button>
              </div>
          </form>
      </div>
  </div> -->

    <div *ngIf="isEditModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
        (click)="closeEditModal()">
        <div class="bg-white p-6 rounded-lg w-1/2 max-w-3xl" (click)="$event.stopPropagation()">
            <h3 class="text-lg font-semibold mb-4 text-gray-800">Edit Timesheet</h3>
            <form #editTimesheetForm="ngForm" (ngSubmit)="updateTimesheet(editTimesheetForm); $event.preventDefault()">
                <div class="grid grid-cols-4 gap-4">
                    <!-- Date -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Date*</label>
                        <input type="date" [(ngModel)]="editSelectedDate" name="editSelectedDate"
                            #editSelectedDateInput="ngModel" required
                            class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                            [ngClass]="{'border-red-500': (editSelectedDateInput.invalid && editSelectedDateInput.touched) || (editTimesheetForm.submitted && editSelectedDateInput.invalid)}">
                        <span class="text-xs text-red-500"
                            *ngIf="(editSelectedDateInput.invalid && editSelectedDateInput.touched) || (editTimesheetForm.submitted && editSelectedDateInput.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Customer -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Customer*</label>
                        <ng-select [(ngModel)]="editSelectedCustomer" name="editSelectedCustomer"
                            #editSelectedCustomerInput="ngModel" (change)="onEditCustomerChange()" required
                            [ngClass]="{'border-red-500': (editSelectedCustomerInput.invalid && editSelectedCustomerInput.touched) || (editTimesheetForm.submitted && editSelectedCustomerInput.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Customer</ng-option>
                            <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                                {{ customer.customer_name }}
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(editSelectedCustomerInput.invalid && editSelectedCustomerInput.touched) || (editTimesheetForm.submitted && editSelectedCustomerInput.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Project -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Project*</label>
                        <ng-select [(ngModel)]="editSelectedProject" name="editSelectedProject"
                            #editSelectedProjectInput="ngModel" [disabled]="!editSelectedCustomer"
                            (change)="onEditProjectChange()" required
                            [ngClass]="{'border-red-500': (editSelectedProjectInput.invalid && editSelectedProjectInput.touched) || (editTimesheetForm.submitted && editSelectedProjectInput.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Project</ng-option>
                            <ng-option *ngFor="let project of filterOptionProjects" [value]="project.project_id">
                                {{ project.project_name }}
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(editSelectedProjectInput.invalid && editSelectedProjectInput.touched) || (editTimesheetForm.submitted && editSelectedProjectInput.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Deliverable -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Deliverable*</label>
                        <ng-select [(ngModel)]="editSelectedDeliverable" name="editSelectedDeliverable"
                            #editSelectedDeliverableInput="ngModel" [disabled]="!editSelectedProject"
                            (change)="onEditDeliverableChange()" required
                            [ngClass]="{'border-red-500': (editSelectedDeliverableInput.invalid && editSelectedDeliverableInput.touched) || (editTimesheetForm.submitted && editSelectedDeliverableInput.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Deliverable</ng-option>
                            <ng-option *ngFor="let deliverable of filterOptionProjectDeliverables"
                                [value]="deliverable.pd_id">
                                {{ deliverable.project_deliverable_name }}
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(editSelectedDeliverableInput.invalid && editSelectedDeliverableInput.touched) || (editTimesheetForm.submitted && editSelectedDeliverableInput.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Phase -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Phase*</label>
                        <ng-select [(ngModel)]="editSelectedPhase" name="editSelectedPhase"
                            #editSelectedPhaseInput="ngModel" [disabled]="!editSelectedDeliverable" required
                            [ngClass]="{'border-red-500': (editSelectedPhaseInput.invalid && editSelectedPhaseInput.touched) || (editTimesheetForm.submitted && editSelectedPhaseInput.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Phase</ng-option>
                            <ng-option *ngFor="let phase of filterOptionPhases" [value]="phase.phase_id">
                                {{ phase.project_phase_name }}
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(editSelectedPhaseInput.invalid && editSelectedPhaseInput.touched) || (editTimesheetForm.submitted && editSelectedPhaseInput.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Hours -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Hours*</label>
                        <select [(ngModel)]="editSelectedHours" name="editSelectedHours"
                            #editSelectedHoursInput="ngModel" required
                            class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                            [ngClass]="{'border-red-500': (editSelectedHoursInput.invalid && editSelectedHoursInput.touched) || (editTimesheetForm.submitted && editSelectedHoursInput.invalid)}">
                            <option *ngFor="let hour of hoursList" [value]="hour">{{ hour }}</option>
                        </select>
                        <span class="text-xs text-red-500"
                            *ngIf="(editSelectedHoursInput.invalid && editSelectedHoursInput.touched) || (editTimesheetForm.submitted && editSelectedHoursInput.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Minutes -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Minutes*</label>
                        <select [(ngModel)]="editSelectedMinutes" name="editSelectedMinutes"
                            #editSelectedMinutesInput="ngModel" required
                            class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                            [ngClass]="{'border-red-500': (editSelectedMinutesInput.invalid && editSelectedMinutesInput.touched) || (editTimesheetForm.submitted && editSelectedMinutesInput.invalid)}">
                            <option *ngFor="let minute of minutesList" [value]="minute">{{ minute }}</option>
                        </select>
                        <span class="text-xs text-red-500"
                            *ngIf="(editSelectedMinutesInput.invalid && editSelectedMinutesInput.touched) || (editTimesheetForm.submitted && editSelectedMinutesInput.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Task Status -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Task Status*</label>
                        <div class="flex items-center space-x-3">
                            <span class="text-xs font-medium" [class.text-gray-500]="editSelectedTaskStatus === 0"
                                [class.text-green-600]="editSelectedTaskStatus === 1">
                                {{ editSelectedTaskStatus === 1 ? 'âœ… Completed' : 'âš  In Progress' }}
                            </span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" [(ngModel)]="editSelectedTaskStatus"
                                    name="editSelectedTaskStatus" (ngModelChange)="onEditTaskStatusChange($event)">
                                <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer
                       peer-checked:after:translate-x-full peer-checked:after:border-white
                       after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white
                       after:border after:rounded-full after:h-5 after:w-5 after:transition-all
                       peer-checked:bg-green-600">
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Task Description -->
                    <div class="space-y-1 col-span-4">
                        <label class="text-xs font-medium text-gray-600">Task Description*</label>
                        <textarea [(ngModel)]="editTaskDescription" name="editTaskDescription"
                            #editTaskDescriptionInput="ngModel" rows="3" required
                            class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                            [ngClass]="{'border-red-500': (editTaskDescriptionInput.invalid && editTaskDescriptionInput.touched) || (editTimesheetForm.submitted && editTaskDescriptionInput.invalid)}"></textarea>
                        <span class="text-xs text-red-500"
                            *ngIf="(editTaskDescriptionInput.invalid && editTaskDescriptionInput.touched) || (editTimesheetForm.submitted && editTaskDescriptionInput.invalid)">
                            Required
                        </span>
                    </div>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button"
                        class="text-xs bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-all shadow-sm"
                        (click)="closeEditModal()">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex items-center text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                        Update Timesheet
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>