<div class="p-4">


    <div *ngIf="selectedSection === 'backdateRequests'">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">
            <div class="mb-6 pb-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                            clip-rule="evenodd" />
                    </svg>
                    Backdate Timesheet Requests
                </h3>
                <p class="text-xs text-gray-500 mt-1">Approve or reject employee requests for backdated timesheet
                    entries</p>
            </div>

            <!-- Filter Section -->
            <div class="flex flex-wrap items-center gap-2 mb-4 py-2 bg-gray-50 rounded shadow-sm">
                <!-- Project Filter -->
                <div class="relative w-full md:w-auto">
                    <label class="block text-xs font-medium mb-1">Project</label>
                    <ng-select [(ngModel)]="backdateRequestProjectFilter" (change)="applyBackdateRequestFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true" [searchable]="true">
                        <ng-option [value]="">All Projects</ng-option>
                        <ng-option *ngFor="let project of managerProjects" [value]="project.project_id">
                            {{ project.project_name }}
                        </ng-option>
                    </ng-select>
                </div>

                <!-- Status Filter -->
                <div class="relative w-full md:w-auto">
                    <label class="block text-xs font-medium mb-1">Status</label>
                    <ng-select [(ngModel)]="backdateRequestStatusFilter" (change)="applyBackdateRequestFilters()"
                        class="text-xs custom-ng-select-filter" [clearable]="true">
                        <ng-option [value]="">All Statuses</ng-option>
                        <ng-option value="pending">Pending</ng-option>
                        <ng-option value="approved">Approved</ng-option>
                        <ng-option value="rejected">Rejected</ng-option>
                    </ng-select>
                </div>

                <!-- Date Range Filter -->
                <div class="relative w-full md:w-auto">
                    <label class="block text-xs font-medium mb-1">Requested Date</label>
                    <input type="date" [(ngModel)]="backdateRequestDateFilter" (change)="applyBackdateRequestFilters()"
                        class="text-xs border border-gray-300 rounded px-2 py-1 w-full">
                </div>

                <!-- Clear Filters Button -->
                <div class="relative w-full md:w-auto self-end">
                    <button (click)="clearBackdateRequestFilters()" title="Clear all filters"
                        class="text-xs text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded px-2 py-1 h-6 flex items-center space-x-1 hover:bg-gray-50 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                        <span>Clear</span>
                    </button>
                </div>
            </div>

            <!-- Requests Table -->
            <div class="rounded-lg w-full overflow-x-auto">
                <table class="min-w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-2 py-2 border border-gray-200 text-center">#</th>
                            <th class="px-2 py-2 border border-gray-200 text-center">Employee</th>
                            <th class="px-2 py-2 border border-gray-200 text-center">Project</th>
                            <th class="px-2 py-2 border border-gray-200 text-center">Requested Date</th>
                            <th class="px-2 py-2 border border-gray-200 text-center">Reason</th>
                            <th class="px-2 py-2 border border-gray-200 text-center">Status</th>
                            <th class="px-2 py-2 border border-gray-200 text-center">Valid Until</th>
                            <th class="px-2 py-2 border border-gray-200 text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let request of paginatedBackdateRequests; let i = index" class="hover:bg-gray-50">
                            <td class="px-2 py-2 border border-gray-300 text-center">{{ i + 1 }}</td>
                            <td class="px-2 py-2 border border-gray-300 text-center">{{ request.user_name }}</td>
                            <td class="px-2 py-2 border border-gray-300 text-center">{{ request.project_name }}</td>
                            <td class="px-2 py-2 border border-gray-300 text-center">{{ request.requested_date |
                                date:'dd-MMM-yyyy' }}</td>
                            <td class="px-2 py-2 border border-gray-300 text-center max-w-xs truncate">{{ request.reason
                                }}</td>
                            <td class="px-2 py-2 border border-gray-300 text-center">
                                <span [ngClass]="{
                      'bg-yellow-100 text-yellow-800': request.status === 'pending',
                      'bg-green-100 text-green-800': request.status === 'approved',
                      'bg-red-100 text-red-800': request.status === 'rejected'
                    }" class="px-2 py-1 rounded-full text-xs">
                                    {{ request.status | titlecase }}
                                </span>
                            </td>
                            <td class="px-2 py-2 border border-gray-300 text-center">
                                {{ request.valid_until | date:'dd-MMM-yyyy' }}
                            </td>
                            <td class="px-2 py-2 border border-gray-300 text-center">
                                <div *ngIf="request.status === 'pending'" class="flex justify-center space-x-1">
                                    <button (click)="processBackdateRequest(request.request_id, 'approved')"
                                        class="text-green-600 hover:text-green-800 p-1" title="Approve">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M5 13l4 4L19 7" />
                                        </svg>
                                    </button>
                                    <button (click)="processBackdateRequest(request.request_id, 'rejected')"
                                        class="text-red-600 hover:text-red-800 p-1" title="Reject">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <div *ngIf="request.status !== 'pending'" class="text-xs">
                                    <span class="block">{{ request.status | titlecase }}</span>
                                    <span *ngIf="request.processed_by_name" class="block text-gray-500">by {{
                                        request.processed_by_name }}</span>
                                    <span *ngIf="request.processed_at" class="block text-gray-500 text-xs">
                                        on {{ request.processed_at | date:'shortDate' }}
                                    </span>
                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="backdateRequests.length === 0">
                            <td colspan="8" class="px-4 py-4 text-center text-gray-500">No backdate requests found</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="flex items-center justify-center mt-4 space-x-1">
                <button (click)="changeBackdateRequestPage(backdateRequestCurrentPage - 1)"
                    [disabled]="backdateRequestCurrentPage === 1" class="px-3 py-1 border rounded-md">
                    Previous
                </button>
                <button *ngFor="let page of getVisibleBackdateRequestPageNumbers()"
                    (click)="changeBackdateRequestPage(page)" [class.bg-blue-500]="backdateRequestCurrentPage === page"
                    [class.text-white]="backdateRequestCurrentPage === page" class="px-3 py-1 border rounded-md">
                    {{ page }}
                </button>
                <button (click)="changeBackdateRequestPage(backdateRequestCurrentPage + 1)"
                    [disabled]="backdateRequestCurrentPage === backdateRequestTotalPages"
                    class="px-3 py-1 border rounded-md">
                    Next
                </button>
            </div>
        </div>
    </div>














    <div *ngIf="selectedSection === 'projectDeliverable'">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">

            <div class="mb-6 pb-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                            clip-rule="evenodd" />
                    </svg>
                    Add New Project Deliverable
                </h3>
                <p class="text-xs text-gray-500 mt-1">Fill all required fields (*) to create new project deliverable</p>
            </div>


            <!-- <form #projectDeliverableFormRef="ngForm"
                (ngSubmit)="submitProjectDeliverable(projectDeliverableFormRef); $event.preventDefault()">
                <div class="grid grid-cols-3 gap-4">


                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Customer Name*</label>
                        <ng-select [(ngModel)]="projectDeliverableForm.customer_id" #customerField="ngModel"
                            name="customer_id" required (change)="filterProjectsByCustomerForDeliverable()"
                            [ngClass]="{'border-red-500': (customerField.invalid && customerField.touched) || (projectDeliverableFormRef.submitted && customerField.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Customer</ng-option>
                            <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                                {{ customer.customer_name }}
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(customerField.invalid && customerField.touched) || (projectDeliverableFormRef.submitted && customerField.invalid)">
                            Required
                        </span>
                    </div>


                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Project*</label>
                        <ng-select [(ngModel)]="projectDeliverableForm.project_id" #projectField="ngModel"
                            name="project_id" required [disabled]="!projectDeliverableForm.customer_id"
                            [ngClass]="{'border-red-500': (projectField.invalid && projectField.touched) || (projectDeliverableFormRef.submitted && projectField.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Project</ng-option>
                            <ng-option *ngFor="let project of filteredProjects" [value]="project.project_id">
                                {{ project.project_name }}
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(projectField.invalid && projectField.touched) || (projectDeliverableFormRef.submitted && projectField.invalid)">
                            Required
                        </span>
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Deliverable Name*</label>
                        <input type="text" [(ngModel)]="projectDeliverableForm.project_deliverable_name"
                            #deliverableField="ngModel" name="project_deliverable_name" required
                            class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Enter deliverable name"
                            [ngClass]="{'border-red-500': (deliverableField.invalid && deliverableField.touched) || (projectDeliverableFormRef.submitted && deliverableField.invalid)}" />
                        <span class="text-xs text-red-500"
                            *ngIf="(deliverableField.invalid && deliverableField.touched) || (projectDeliverableFormRef.submitted && deliverableField.invalid)">
                            Required
                        </span>
                    </div>
                </div>

                <div class="mt-6 flex justify-center">
                    <button type="submit"
                        class="flex items-center text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                        Save Deliverable
                    </button>
                </div>
            </form> -->
            <form #projectDeliverableFormRef="ngForm"
                (ngSubmit)="submitProjectDeliverable(projectDeliverableFormRef); $event.preventDefault()">
                <div class="grid grid-cols-2 gap-4">
                    <!-- Project Selection -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Project*</label>
                        <ng-select [(ngModel)]="projectDeliverableForm.project_id" #projectField="ngModel"
                            name="project_id" required
                            [ngClass]="{'border-red-500': (projectField.invalid && projectField.touched) || (projectDeliverableFormRef.submitted && projectField.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Project</ng-option>
                            <ng-option *ngFor="let project of managerProjects" [value]="project.project_id">
                                {{ project.project_name }} ({{ project.customer_name }})
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(projectField.invalid && projectField.touched) || (projectDeliverableFormRef.submitted && projectField.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Deliverable Name -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Deliverable Name*</label>
                        <input type="text" [(ngModel)]="projectDeliverableForm.project_deliverable_name"
                            #deliverableField="ngModel" name="project_deliverable_name" required
                            class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Enter deliverable name"
                            [ngClass]="{'border-red-500': (deliverableField.invalid && deliverableField.touched) || (projectDeliverableFormRef.submitted && deliverableField.invalid)}" />
                        <span class="text-xs text-red-500"
                            *ngIf="(deliverableField.invalid && deliverableField.touched) || (projectDeliverableFormRef.submitted && deliverableField.invalid)">
                            Required
                        </span>
                    </div>
                </div>

                <div class="mt-6 flex justify-center">
                    <button type="submit"
                        class="flex items-center text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                        Save Deliverable
                    </button>
                </div>
            </form>
        </div>

        <div class="rounded-lg w-full overflow-x-auto p-2 bg-white shadow-sm border border-gray-200">
            <!-- Filter Section -->
            <div class="min-w-full relative">
                <div class="flex flex-nowrap items-start gap-x-2 gap-y-2 mb-4 py-2 bg-gray-50 rounded shadow-sm w-full overflow-x-auto"
                    style="overflow: visible;">

                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Customer</label>
                        <ng-select [(ngModel)]="deliverableCustomerFilter" (change)="applyDeliverableFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Customers</ng-option>
                            <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_name">
                                {{ customer.customer_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Project Name Filter -->
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Project</label>
                        <ng-select [(ngModel)]="deliverableProjectFilter" (change)="applyDeliverableFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Projects</ng-option>
                            <ng-option *ngFor="let project of optionProject" [value]="project.project_name">
                                {{ project.project_name }}
                            </ng-option>
                        </ng-select>
                    </div>




                    <!-- Deliverable Name Filter -->
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Deliverable</label>
                        <input type="text" [(ngModel)]="deliverableNameFilter" (input)="applyDeliverableFilters()"
                            placeholder="Search Deliverable"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6" />
                    </div>

                    <!-- Customer Name Filter -->


                    <!-- Clear All Filters -->
                    <!-- <button (click)="clearDeliverableFilters()"
                        class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none flex-grow-0">Clear
                        All Filters</button> -->
                    <div class="relative w-28">

                        <div class="h-[1.325rem]"></div> <!-- Exactly halfway between h-4 (1rem) and h-5 (1.25rem) -->

                        <button (click)="clearDeliverableFilters()" title="Clear all filters"
                            class="text-xs text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded px-2 py-1 h-6 flex items-center space-x-1 hover:bg-gray-50 transition-colors shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Scrollable Table -->
            <div class="rounded-lg w-full inline-block whitespace-nowrap">
                <table class="min-w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-200 text-center bg-gray-50">
                                #</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Customer</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Project</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Deliverable</th>
                            <th class="sticky right-0 px-1 py-1 border border-gray-200 text-center bg-gray-50">Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let deliverable of paginatedProjectDeliverables; let i = index"
                            class="hover:bg-gray-50">
                            <td
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                                {{ i + 1 }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ deliverable.customer_name || '-'
                                }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ deliverable.project_name || '-'
                                }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{
                                deliverable.project_deliverable_name || '-' }}</td>
                            <td
                                class="sticky right-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                                <button (click)="openEditDeliverableModal(deliverable)"
                                    class="text-green-600 hover:text-green-800 p-1" title="Edit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <button (click)="deleteProjectDeliverable(deliverable.pd_id)"
                                    class="text-red-600 hover:text-red-800 p-1" title="Delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Pagination Controls -->
        <div class="flex items-center justify-center mt-4 space-x-1">
            <!-- Previous button -->
            <button (click)="changeDeliverablePage(deliverableCurrentPage - 1)"
                [disabled]="deliverableCurrentPage === 1" class="px-3 py-1 border rounded-md">
                Previous
            </button>

            <!-- First Page button -->
            <button *ngIf="deliverableCurrentPage > 3" (click)="changeDeliverablePage(1)"
                class="px-3 py-1 border rounded-md">
                1
            </button>

            <!-- Ellipsis -->
            <span *ngIf="deliverableCurrentPage > 4" class="px-2">...</span>

            <!-- Page Numbers -->
            <button *ngFor="let page of getVisibleDeliverablePageNumbers()" (click)="changeDeliverablePage(page)"
                [class.bg-blue-500]="deliverableCurrentPage === page" class="px-3 py-1 border rounded-md">
                {{ page }}
            </button>

            <!-- Ellipsis -->
            <span *ngIf="deliverableCurrentPage < deliverableTotalPages - 3" class="px-2">...</span>

            <!-- Last Page button -->
            <button *ngIf="deliverableCurrentPage < deliverableTotalPages - 2"
                (click)="changeDeliverablePage(deliverableTotalPages)" class="px-3 py-1 border rounded-md">
                {{ deliverableTotalPages }}
            </button>

            <!-- Next button -->
            <button (click)="changeDeliverablePage(deliverableCurrentPage + 1)"
                [disabled]="deliverableCurrentPage === deliverableTotalPages" class="px-3 py-1 border rounded-md">
                Next
            </button>
        </div>

        <!-- <div *ngIf="isEditDeliverableModalOpen"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
            (click)="closeEditDeliverableModal()">
            <div class="bg-white p-6 rounded-lg w-auto" (click)="$event.stopPropagation()">
                <h3 class="text-xl font-semibold mb-4">Edit Project Deliverable</h3>
                <form #editDeliverableForm="ngForm"
                    (ngSubmit)="updateProjectDeliverable(editDeliverableForm); $event.preventDefault()">
                    <div class="grid grid-cols-6 gap-4">
                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Customer*</label>
                            <ng-select [(ngModel)]="editDeliverableData.customer_id" #editCustomerField="ngModel"
                                name="customer_id" required (change)="onEditCustomerChangeDel()"
                                [ngClass]="{'border-red-500': (editDeliverableForm.submitted || editCustomerField?.touched) && editCustomerField?.invalid}"
                                class="custom-ng-select">
                                <ng-option [value]="" disabled selected>Select Customer</ng-option>
                                <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_id">
                                    {{ customer.customer_name }}
                                </ng-option>
                            </ng-select>
                            <span class="text-red-500 text-sm"
                                *ngIf="(editDeliverableForm.submitted || editCustomerField?.touched) && editCustomerField?.invalid">
                                Customer is required.
                            </span>
                        </div>

                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Project*</label>
                            <ng-select [(ngModel)]="editDeliverableData.project_id" #editProjectField="ngModel"
                                name="project_id" required [disabled]="!editDeliverableData.customer_id"
                                [clearable]="true"
                                [ngClass]="{'border-red-500': (editDeliverableForm.submitted || editProjectField?.touched) && editProjectField?.invalid}"
                                class="custom-ng-select">
                                <ng-option [value]="" disabled selected>Select Project</ng-option>
                                <ng-option *ngFor="let project of filteredEditProjects" [value]="project.project_id">
                                    {{ project.project_name }}
                                </ng-option>
                            </ng-select>
                            <span class="text-red-500 text-sm"
                                *ngIf="(editDeliverableForm.submitted || editProjectField?.touched) && editProjectField?.invalid">
                                Project is required.
                            </span>
                        </div>

                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Deliverable Name*</label>
                            <input type="text" class="border p-2 w-full rounded-md"
                                [(ngModel)]="editDeliverableData.project_deliverable_name"
                                #editDeliverableNameField="ngModel" name="project_deliverable_name" required
                                [ngClass]="{'border-red-500': (editDeliverableForm.submitted || editDeliverableNameField?.touched) && editDeliverableNameField?.invalid}">
                            <span class="text-red-500 text-sm"
                                *ngIf="(editDeliverableForm.submitted || editDeliverableNameField?.touched) && editDeliverableNameField?.invalid">
                                Deliverable name is required.
                            </span>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded mr-2"
                            (click)="closeEditDeliverableModal()">Cancel</button>
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Update</button>
                    </div>
                </form>
            </div>
        </div> -->


        <!-- <div *ngIf="isEditDeliverableModalOpen"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
            (click)="closeEditDeliverableModal()">
            <div class="bg-white p-6 rounded-lg w-auto" (click)="$event.stopPropagation()">
                <h3 class="text-xl font-semibold mb-4">Edit Project Deliverable</h3>
                <form #editDeliverableForm="ngForm"
                    (ngSubmit)="updateProjectDeliverable(editDeliverableForm); $event.preventDefault()">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Project*</label>
                            <ng-select [(ngModel)]="editDeliverableData.project_id" #editProjectField="ngModel"
                                name="project_id" required
                                [ngClass]="{'border-red-500': (editDeliverableForm.submitted || editProjectField?.touched) && editProjectField?.invalid}"
                                class="custom-ng-select">
                                <ng-option [value]="" disabled selected>Select Project</ng-option>
                                <ng-option *ngFor="let project of managerProjects" [value]="project.project_id">
                                    {{ project.project_name }} ({{ project.customer_name }})
                                </ng-option>
                            </ng-select>
                            <span class="text-red-500 text-sm"
                                *ngIf="(editDeliverableForm.submitted || editProjectField?.touched) && editProjectField?.invalid">
                                Project is required.
                            </span>
                        </div>

                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Deliverable Name*</label>
                            <input type="text" class="border p-2 w-full rounded-md"
                                [(ngModel)]="editDeliverableData.project_deliverable_name"
                                #editDeliverableNameField="ngModel" name="project_deliverable_name" required
                                [ngClass]="{'border-red-500': (editDeliverableForm.submitted || editDeliverableNameField?.touched) && editDeliverableNameField?.invalid}">
                            <span class="text-red-500 text-sm"
                                *ngIf="(editDeliverableForm.submitted || editDeliverableNameField?.touched) && editDeliverableNameField?.invalid">
                                Deliverable name is required.
                            </span>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded mr-2"
                            (click)="closeEditDeliverableModal()">Cancel</button>
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Update</button>
                    </div>
                </form>
            </div>
        </div> -->
        <div *ngIf="isEditDeliverableModalOpen"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
            (click)="closeEditDeliverableModal()">
            <div class="bg-white p-6 rounded-lg w-1/2 max-w-3xl" (click)="$event.stopPropagation()">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">Edit Project Deliverable</h3>
                <form #editDeliverableForm="ngForm"
                    (ngSubmit)="updateProjectDeliverable(editDeliverableForm); $event.preventDefault()">
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Project Selection -->
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-600">Project*</label>
                            <ng-select [(ngModel)]="editDeliverableData.project_id" #editProjectField="ngModel"
                                name="project_id" required [searchable]="true" [clearable]="true"
                                [ngClass]="{'border-red-500': (editDeliverableForm.submitted || editProjectField?.touched) && editProjectField?.invalid}"
                                class="text-xs custom-ng-select">
                                <ng-option *ngFor="let project of managerProjects" [value]="project.project_id">
                                    {{ project.project_name }} ({{ project.customer_name }})
                                </ng-option>
                            </ng-select>
                            <span class="text-xs text-red-500"
                                *ngIf="(editDeliverableForm.submitted || editProjectField?.touched) && editProjectField?.invalid">
                                Required
                            </span>
                        </div>

                        <!-- Deliverable Name Field -->
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-600">Deliverable Name*</label>
                            <input type="text"
                                class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                [(ngModel)]="editDeliverableData.project_deliverable_name"
                                #editDeliverableNameField="ngModel" name="project_deliverable_name" required
                                [ngClass]="{'border-red-500': (editDeliverableForm.submitted || editDeliverableNameField?.touched) && editDeliverableNameField?.invalid}">
                            <span class="text-xs text-red-500"
                                *ngIf="(editDeliverableForm.submitted || editDeliverableNameField?.touched) && editDeliverableNameField?.invalid">
                                Required
                            </span>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button"
                            class="text-xs bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-all shadow-sm"
                            (click)="closeEditDeliverableModal()">
                            Cancel
                        </button>
                        <button type="submit"
                            class="flex items-center text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                            Update Deliverable
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <div *ngIf="selectedSection === 'projectPhases'">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">

            <div class="mb-6 pb-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                            clip-rule="evenodd" />
                    </svg>
                    Add New Project Task
                </h3>
                <p class="text-xs text-gray-500 mt-1">Fill all required fields (*) to create new project Task</p>
            </div>

            <form #projectPhaseFormRef="ngForm"
                (ngSubmit)="submitProjectPhase(projectPhaseFormRef); $event.preventDefault()">
                <div class="grid grid-cols-3 gap-4">
                    <!-- Project Selection -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Project*</label>
                        <ng-select [(ngModel)]="projectPhaseForm.project_id" #projectField="ngModel" name="project_id"
                            required (change)="filterDeliverablesForPhases()"
                            [ngClass]="{'border-red-500': (projectField.invalid && projectField.touched) || (projectPhaseFormRef.submitted && projectField.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Project</ng-option>
                            <ng-option *ngFor="let project of managerProjects" [value]="project.project_id">
                                {{ project.project_name }} ({{ project.customer_name }})
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(projectField.invalid && projectField.touched) || (projectPhaseFormRef.submitted && projectField.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Deliverable Selection -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Deliverable*</label>
                        <ng-select [(ngModel)]="projectPhaseForm.pd_id" #deliverableField="ngModel" name="pd_id"
                            required [disabled]="!projectPhaseForm.project_id"
                            [ngClass]="{'border-red-500': (deliverableField.invalid && deliverableField.touched) || (projectPhaseFormRef.submitted && deliverableField.invalid)}"
                            class="text-xs custom-ng-select">
                            <ng-option [value]="" disabled selected>Select Deliverable</ng-option>
                            <ng-option *ngFor="let deliverable of filteredDeliverables" [value]="deliverable.pd_id">
                                {{ deliverable.project_deliverable_name }}
                            </ng-option>
                        </ng-select>
                        <span class="text-xs text-red-500"
                            *ngIf="(deliverableField.invalid && deliverableField.touched) || (projectPhaseFormRef.submitted && deliverableField.invalid)">
                            Required
                        </span>
                    </div>

                    <!-- Phase Name -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-600">Task Name*</label>
                        <input type="text" [(ngModel)]="projectPhaseForm.project_phase_name" #phaseField="ngModel"
                            name="project_phase_name" required placeholder="Enter Task name"
                            class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                            [ngClass]="{'border-red-500': (phaseField.invalid && phaseField.touched) || (projectPhaseFormRef.submitted && phaseField.invalid)}" />
                        <span class="text-xs text-red-500"
                            *ngIf="(phaseField.invalid && phaseField.touched) || (projectPhaseFormRef.submitted && phaseField.invalid)">
                            Required
                        </span>
                    </div>
                </div>

                <div class="mt-6 flex justify-center">
                    <button type="submit"
                        class="flex items-center text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                        Save Task
                    </button>
                </div>
            </form>
        </div>

        <!-- Filter Section -->
        <div class="rounded-lg w-full overflow-x-auto p-2 bg-white shadow-sm border border-gray-200">
            <div class="min-w-full relative ">
                <div class="flex flex-nowrap items-start gap-x-2 gap-y-2 mb-4 py-2 bg-gray-50 rounded shadow-sm w-full overflow-x-auto"
                    style="overflow: visible;">

                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Customer</label>
                        <ng-select [(ngModel)]="phaseCustomerFilter" (change)="applyPhaseFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Customers</ng-option>
                            <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_name">
                                {{ customer.customer_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Project Name Filter -->
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Project</label>
                        <ng-select [(ngModel)]="phaseProjectFilter" (change)="applyPhaseFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Projects</ng-option>
                            <ng-option *ngFor="let project of optionProject" [value]="project.project_name">
                                {{ project.project_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Deliverable Filter -->
                    <!-- Deliverable Filter -->
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Deliverable</label>
                        <ng-select [(ngModel)]="phaseDeliverableFilter" (change)="applyPhaseFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Deliverables</ng-option>
                            <ng-option *ngFor="let deliverable of optionDeliverables"
                                [value]="deliverable.project_deliverable_name">
                                {{ deliverable.project_deliverable_name }}
                            </ng-option>
                        </ng-select>
                    </div>



                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Task</label>
                        <input type="text" [(ngModel)]="phaseNameFilter" (input)="applyPhaseFilters()"
                            placeholder="Search Phase"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6" />
                    </div>




                    <!-- Clear All Filters -->
                    <!-- <button (click)="clearPhaseFilters()"
                        class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none flex-grow-0">Clear
                        All Filters</button> -->
                    <div class="relative w-28">

                        <div class="h-[1.325rem]"></div> <!-- Exactly halfway between h-4 (1rem) and h-5 (1.25rem) -->

                        <button (click)="clearPhaseFilters()" title="Clear all filters"
                            class="text-xs text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded px-2 py-1 h-6 flex items-center space-x-1 hover:bg-gray-50 transition-colors shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Scrollable Table -->
            <div class="rounded-lg w-full inline-block whitespace-nowrap">
                <table class="min-w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-200 text-center bg-gray-50">
                                #</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Customer</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Project</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Deliverable</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Task</th>
                            <th class="sticky right-0 px-1 py-1 border border-gray-200 text-center bg-gray-50">Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let phase of paginatedProjectPhases; let i = index" class="hover:bg-gray-50">
                            <td
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                                {{ i + 1 }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ phase.customer_name || '-' }}
                            </td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ phase.project_name || '-' }}
                            </td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ phase.project_deliverable_name
                                || '-' }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ phase.project_phase_name || '-'
                                }}</td>
                            <td
                                class="sticky right-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                                <button (click)="openEditPhaseModal(phase)"
                                    class="text-green-600 hover:text-green-800 p-1" title="Edit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <button (click)="deleteProjectPhase(phase.phase_id)"
                                    class="text-red-600 hover:text-red-800 p-1" title="Delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination Controls -->
        <div class="flex items-center justify-center mt-4 space-x-1">
            <button (click)="changePhasePage(phaseCurrentPage - 1)" [disabled]="phaseCurrentPage === 1"
                class="px-3 py-1 border rounded-md">
                Previous
            </button>
            <button *ngIf="phaseCurrentPage > 3" (click)="changePhasePage(1)"
                class="px-3 py-1 border rounded-md">1</button>
            <span *ngIf="phaseCurrentPage > 4" class="px-2">...</span>
            <button *ngFor="let page of getVisiblePhasePageNumbers()" (click)="changePhasePage(page)"
                [class.bg-blue-500]="phaseCurrentPage === page" class="px-3 py-1 border rounded-md">{{ page }}</button>
            <span *ngIf="phaseCurrentPage < phaseTotalPages - 3" class="px-2">...</span>
            <button *ngIf="phaseCurrentPage < phaseTotalPages - 2" (click)="changePhasePage(phaseTotalPages)"
                class="px-3 py-1 border rounded-md">{{ phaseTotalPages }}</button>
            <button (click)="changePhasePage(phaseCurrentPage + 1)" [disabled]="phaseCurrentPage === phaseTotalPages"
                class="px-3 py-1 border rounded-md">Next</button>
        </div>


        <!-- <div *ngIf="isEditPhaseModalOpen"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
            (click)="closeEditPhaseModal()">
            <div class="bg-white p-6 rounded-lg w-auto" (click)="$event.stopPropagation()">
                <h3 class="text-xl font-semibold mb-4">Edit Project Phase</h3>
                <form #editPhaseForm="ngForm" (ngSubmit)="updateProjectPhase(editPhaseForm); $event.preventDefault()">
                    <div class="grid grid-cols-3 gap-4">
                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Project*</label>
                            <ng-select [(ngModel)]="editPhaseData.project_id" #editProjectField="ngModel"
                                name="project_id" required (change)="onEditProjectChange()"
                                [ngClass]="{'border-red-500': (editPhaseForm.submitted || editProjectField?.touched) && editProjectField?.invalid}"
                                class="custom-ng-select">
                                <ng-option [value]="" disabled selected>Select Project</ng-option>
                                <ng-option *ngFor="let project of managerProjects" [value]="project.project_id">
                                    {{ project.project_name }} ({{ project.customer_name }})
                                </ng-option>
                            </ng-select>
                            <span class="text-red-500 text-sm"
                                *ngIf="(editPhaseForm.submitted || editProjectField?.touched) && editProjectField?.invalid">
                                Project is required.
                            </span>
                        </div>

                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Deliverable*</label>
                            <ng-select [(ngModel)]="editPhaseData.pd_id" #editDeliverableField="ngModel" name="pd_id"
                                required [disabled]="!editPhaseData.project_id"
                                [ngClass]="{'border-red-500': (editPhaseForm.submitted || editDeliverableField?.touched) && editDeliverableField?.invalid}"
                                class="custom-ng-select">
                                <ng-option [value]="" disabled selected>Select Deliverable</ng-option>
                                <ng-option *ngFor="let deliverable of filteredEditDeliverables"
                                    [value]="deliverable.pd_id">
                                    {{ deliverable.project_deliverable_name }}
                                </ng-option>
                            </ng-select>
                            <span class="text-red-500 text-sm"
                                *ngIf="(editPhaseForm.submitted || editDeliverableField?.touched) && editDeliverableField?.invalid">
                                Deliverable is required.
                            </span>
                        </div>

                        <div class="form-group">
                            <label class="block mb-2 font-semibold">Phase Name*</label>
                            <input type="text" class="border p-2 w-full rounded-md"
                                [(ngModel)]="editPhaseData.project_phase_name" #editPhaseNameField="ngModel"
                                name="project_phase_name" required
                                [ngClass]="{'border-red-500': (editPhaseForm.submitted || editPhaseNameField?.touched) && editPhaseNameField?.invalid}">
                            <span class="text-red-500 text-sm"
                                *ngIf="(editPhaseForm.submitted || editPhaseNameField?.touched) && editPhaseNameField?.invalid">
                                Phase name is required.
                            </span>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded mr-2"
                            (click)="closeEditPhaseModal()">Cancel</button>
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Update</button>
                    </div>
                </form>
            </div>
        </div> -->

        <div *ngIf="isEditPhaseModalOpen"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]"
            (click)="closeEditPhaseModal()">
            <div class="bg-white p-6 rounded-lg w-1/2 max-w-3xl" (click)="$event.stopPropagation()">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">Edit Project Task</h3>
                <form #editPhaseForm="ngForm" (ngSubmit)="updateProjectPhase(editPhaseForm); $event.preventDefault()">
                    <div class="grid grid-cols-3 gap-4">
                        <!-- Project Selection -->
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-600">Project*</label>
                            <ng-select [(ngModel)]="editPhaseData.project_id" #editProjectField="ngModel"
                                name="project_id" required (change)="onEditProjectChange()" [searchable]="true"
                                [clearable]="true"
                                [ngClass]="{'border-red-500': (editPhaseForm.submitted || editProjectField?.touched) && editProjectField?.invalid}"
                                class="text-xs custom-ng-select">
                                <ng-option *ngFor="let project of managerProjects" [value]="project.project_id">
                                    {{ project.project_name }} ({{ project.customer_name }})
                                </ng-option>
                            </ng-select>
                            <span class="text-xs text-red-500"
                                *ngIf="(editPhaseForm.submitted || editProjectField?.touched) && editProjectField?.invalid">
                                Required
                            </span>
                        </div>

                        <!-- Deliverable Selection -->
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-600">Deliverable*</label>
                            <ng-select [(ngModel)]="editPhaseData.pd_id" #editDeliverableField="ngModel" name="pd_id"
                                required [disabled]="!editPhaseData.project_id" [searchable]="true" [clearable]="true"
                                [ngClass]="{'border-red-500': (editPhaseForm.submitted || editDeliverableField?.touched) && editDeliverableField?.invalid}"
                                class="text-xs custom-ng-select">
                                <ng-option *ngFor="let deliverable of filteredEditDeliverables"
                                    [value]="deliverable.pd_id">
                                    {{ deliverable.project_deliverable_name }}
                                </ng-option>
                            </ng-select>
                            <span class="text-xs text-red-500"
                                *ngIf="(editPhaseForm.submitted || editDeliverableField?.touched) && editDeliverableField?.invalid">
                                Required
                            </span>
                        </div>

                        <!-- Phase Name Field -->
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-600">Task Name*</label>
                            <input type="text"
                                class="text-xs w-full px-2 py-1 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                [(ngModel)]="editPhaseData.project_phase_name" #editPhaseNameField="ngModel"
                                name="project_phase_name" required
                                [ngClass]="{'border-red-500': (editPhaseForm.submitted || editPhaseNameField?.touched) && editPhaseNameField?.invalid}">
                            <span class="text-xs text-red-500"
                                *ngIf="(editPhaseForm.submitted || editPhaseNameField?.touched) && editPhaseNameField?.invalid">
                                Required
                            </span>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button"
                            class="text-xs bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-all shadow-sm"
                            (click)="closeEditPhaseModal()">
                            Cancel
                        </button>
                        <button type="submit"
                            class="flex items-center text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                            Update Task
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <div *ngIf="selectedSection === 'viewMyProjectTeam'">
        <!-- My Project Team -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">
            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M12 6a2 2 0 100-4 2 2 0 000 4zm0 2a2 2 0 100 4 2 2 0 000-4zm0 6a2 2 0 100 4 2 2 0 000-4z"
                        clip-rule="evenodd" />
                </svg>
                My Project Team
            </h3>
            <p class="text-xs text-gray-500 mt-1">View your project team members</p>

        </div>
        <div class="rounded-lg w-full overflow-x-auto p-2 bg-white shadow-sm border border-gray-200">
            <div class="min-w-full relative ">
                <!-- Enhanced Filter Section -->
                <div class="flex flex-nowrap items-start gap-x-2 gap-y-2 mb-4 py-2 bg-gray-50 rounded shadow-sm w-full overflow-x-auto"
                    style="overflow: visible;">


                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Customer</label>
                        <ng-select [(ngModel)]="teamCustomerFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_name">
                                {{ customer.customer_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Project</label>
                        <ng-select [(ngModel)]="teamProjectFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let project of optionProject" [value]="project.project_name">
                                {{ project.project_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Project Manager</label>
                        <ng-select [(ngModel)]="teamManagerFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let manager of optionProjectManagers"
                                [value]="manager.user_first_name + ' ' + manager.user_last_name">
                                {{ manager.user_first_name }} {{ manager.user_last_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Employee</label>
                        <ng-select [(ngModel)]="teamEmployeeFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let user of optionUsers"
                                [value]="user.user_first_name + ' ' + user.user_last_name">
                                {{ user.user_first_name }} {{ user.user_last_name }}
                            </ng-option>
                        </ng-select>
                    </div>


                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Project Role</label>
                        <ng-select [(ngModel)]="teamRoleFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let role of optionProjectRole" [value]="role.project_role_name">
                                {{ role.project_role_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Allocation Status</label>
                        <ng-select [(ngModel)]="teamAllocationStatusFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true">
                            <ng-option [value]="true">Employee</ng-option>
                            <ng-option [value]="false">Shadow</ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Billed Status</label>
                        <ng-select [(ngModel)]="teamBilledStatusFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true">
                            <ng-option [value]="true">Billed</ng-option>
                            <ng-option [value]="false">Not Billed</ng-option>
                        </ng-select>
                    </div>


                    <!-- Date Range Filters -->
                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Start Date</label>
                        <input type="date" [(ngModel)]="teamStartDateFrom" (change)="applyTeamFilters()"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6">
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">End Date</label>
                        <input type="date" [(ngModel)]="teamEndDateTo" (change)="applyTeamFilters()"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6">
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Assignment Status</label>
                        <ng-select [(ngModel)]="teamAssignmentStatusFilter" (change)="applyTeamFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true">
                            <ng-option [value]="0">Active</ng-option>
                            <ng-option [value]="1">Released</ng-option>
                        </ng-select>
                    </div>

                    <!-- Action Buttons -->
                    <!-- <button (click)="clearTeamFilters()"
                        class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none flex-grow-0">
                        Clear All
                    </button> -->
                    <div class="relative w-38">

                        <div class="h-[1.325rem]"></div> <!-- Exactly halfway between h-4 (1rem) and h-5 (1.25rem) -->

                        <button (click)="clearTeamFilters()" title="Clear all filters"
                            class="text-xs text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded px-2 py-1 h-6 flex items-center space-x-1 hover:bg-gray-50 transition-colors shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Project Team Table -->
            <div class="rounded-lg w-full inline-block whitespace-nowrap">
                <table class="min-w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-gray-100">
                            <th
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-200 text-center bg-gray-50">
                                #</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Customer Name</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Project Name</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Project Manager</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Employee Name</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Project Role</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Allocation Status</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Allocation %</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Status</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Start Date</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Tentative End Date</th>

                            <th class="px-1 py-1 border border-gray-200 text-center">Assignment Status</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Released Date</th>


                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let member of paginatedProjectTeamData; let i = index" class="hover:bg-gray-50">
                            <td
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                                {{ (teamCurrentPage - 1) * teamItemsPerPage + i + 1 }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.customer_name }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.project_name }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.project_manager_name }}
                            </td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.employee_name }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.project_role_name }}</td>

                            <!-- <td class="px-1 py-1 border border-gray-300 text-center">{{ member.allocation_status ? 'Active' : 'Inactive' }}</td> -->

                            <td class="px-1 py-1 border border-gray-300 text-center">
                                <span [class.text-green-600]="member.allocation_status"
                                    [class.text-gray-500]="!member.allocation_status">
                                    {{ member.allocation_status ? 'Employee' : 'Shadow' }}
                                </span>
                            </td>


                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.allocation_percentage }}%
                            </td>
                            <!-- <td class="px-1 py-1 border border-gray-300 text-center">{{ member.billed_status ? 'Billed' : 'Not Billed' }}</td> -->
                            <td class="px-1 py-1 border border-gray-300 text-center">
                                <span [class.text-green-600]="member.billed_status"
                                    [class.text-gray-500]="!member.billed_status">
                                    {{ member.billed_status ? 'Billed' : 'Not Billed' }}
                                </span>
                            </td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.start_date |
                                date:'dd-MMM-yyyy' }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.end_date |
                                date:'dd-MMM-yyyy' }}</td>


                            <td class="px-1 py-1 border border-gray-300 text-center">
                                <span *ngIf="member.is_released" class="text-orange-600">Released</span>
                                <span *ngIf="!member.is_released" class="text-green-600">Active</span>
                            </td>

                            <!-- Released Date Column -->
                            <td class="px-1 py-1 border border-gray-300 text-center">
                                <span *ngIf="member.released_date">{{ member.released_date | date:'dd-MMM-yyyy'
                                    }}</span>
                                <span *ngIf="!member.released_date">-</span>
                            </td>


                        </tr>
                    </tbody>
                </table>

                <!-- Pagination Controls -->
                <div class="flex items-center justify-center mt-4 space-x-1">
                    <button (click)="changeTeamPage(teamCurrentPage - 1)" [disabled]="teamCurrentPage === 1"
                        class="px-3 py-1 border rounded-md">
                        Previous
                    </button>
                    <button *ngIf="teamCurrentPage > 3" (click)="changeTeamPage(1)"
                        class="px-3 py-1 border rounded-md">1</button>
                    <span *ngIf="teamCurrentPage > 4" class="px-2">...</span>
                    <button *ngFor="let page of getVisibleTeamPageNumbers()" (click)="changeTeamPage(page)"
                        [class.bg-blue-500]="teamCurrentPage === page" class="px-3 py-1 border rounded-md">{{ page
                        }}</button>
                    <span *ngIf="teamCurrentPage < teamTotalPages - 3" class="px-2">...</span>
                    <button *ngIf="teamCurrentPage < teamTotalPages - 2" (click)="changeTeamPage(teamTotalPages)"
                        class="px-3 py-1 border rounded-md">{{ teamTotalPages }}</button>
                    <button (click)="changeTeamPage(teamCurrentPage + 1)"
                        [disabled]="teamCurrentPage === teamTotalPages"
                        class="px-3 py-1 border rounded-md">Next</button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="selectedSection === 'viewMyProjectTeamsTimesheet'">
        <!-- My Project Team's Timesheet -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M12 6a2 2 0 100-4 2 2 0 000 4zm0 2a2 2 0 100 4 2 2 0 000-4zm0 6a2 2 0 100 4 2 2 0 000-4z"
                                clip-rule="evenodd" />
                        </svg>
                        My Project Team's Timesheet
                    </h3>
                    <p class="text-xs text-gray-500">View and manage your team's timesheet entries</p>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="text-center">
                        <div class="text-xs text-gray-500">Total Entries</div>
                        <div class="font-semibold">{{filteredTimesheetData.length}}</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs text-gray-500">Total Hours</div>
                        <div class="font-semibold text-blue-600">
                            {{calculateTimesheetTotalTime().hours}}h {{calculateTimesheetTotalTime().minutes}}m
                        </div>
                    </div>
                </div>
            </div>

        </div>



        <div class="rounded-lg w-full overflow-x-auto p-2 bg-white shadow-sm border border-gray-200">
            <div class="min-w-full relative ">
                <div class="flex flex-nowrap items-start gap-x-2 gap-y-2 mb-4 py-2 bg-gray-50 rounded shadow-sm w-full overflow-x-auto"
                    style="overflow: visible;">
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Employee</label>
                        <ng-select [(ngModel)]="timesheetEmployeeFilter" (change)="applyTimesheetFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let user of optionTeamMembers" [value]="user.id">
                                {{ user.fullName }}
                            </ng-option>
                        </ng-select>
                    </div>
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Project</label>
                        <ng-select [(ngModel)]="timesheetProjectFilter" (change)="applyTimesheetFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let project of optionProjectsForTimesheet" [value]="project.id">
                                {{ project.name }}
                            </ng-option>
                        </ng-select>
                    </div>
                    <!-- <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Task</label>
                        <ng-select [(ngModel)]="timesheetPhaseFilter" (change)="applyTimesheetFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let phase of optionPhasesForTimesheet" [value]="phase.id">
                                {{ phase.name }}
                            </ng-option>
                        </ng-select>
                    </div> -->

                    <div class="relative w-full">
    <label class="block text-xs font-medium mb-1">Standard Task</label> <!-- Changed from "Task" -->
    <ng-select [(ngModel)]="timesheetTaskFilter" (change)="applyTimesheetFilters()"
        class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
        <ng-option *ngFor="let task of optionStandardTasksForTimesheet" [value]="task.id"> <!-- Changed from optionPhasesForTimesheet -->
            {{ task.name }}
        </ng-option>
    </ng-select>
</div>

                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Deliverable</label>
                        <ng-select [(ngModel)]="timesheetDeliverableFilter" (change)="applyTimesheetFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option *ngFor="let deliverable of optionDeliverablesForTimesheet"
                                [value]="deliverable.id">
                                {{ deliverable.name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <!-- Date Range Filters -->
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Date</label>
                        <input type="date" [(ngModel)]="timesheetDateFilter" (change)="applyTimesheetFilters()"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6">
                    </div>
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Task Status</label>
                        <ng-select [(ngModel)]="timesheetStatusFilter" (change)="applyTimesheetFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true">
                            <ng-option [value]="1">Completed</ng-option>
                            <ng-option [value]="0">In Progress</ng-option>
                        </ng-select>
                    </div>
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Assignment Status</label>
                        <ng-select [(ngModel)]="timesheetAssignmentStatusFilter" (change)="applyTimesheetFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true">
                            <ng-option [value]="1">Active</ng-option>
                            <ng-option [value]="0">Released</ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-28">

                        <div class="h-[1.325rem]"></div> <!-- Exactly halfway between h-4 (1rem) and h-5 (1.25rem) -->

                        <button (click)="clearTimesheetFilters()" title="Clear all filters"
                            class="text-xs text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded px-2 py-1 h-6 flex items-center space-x-1 hover:bg-gray-50 transition-colors shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Timesheet Table -->
            <div class="rounded-lg w-full inline-block whitespace-nowrap">
                <!-- Modify your table structure -->
                <table class="min-w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-200 text-center bg-gray-50">
                            </th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Employee Name</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Date</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Projects</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Total Hours</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Entries</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Assignment Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let timesheet of paginatedTimesheetData; let i = index">
                            <!-- Main aggregated row -->
                            <tr class="hover:bg-gray-50 cursor-pointer"
                                (click)="toggleRowExpansion(timesheet.user_id, timesheet.timesheet_date)">
                                <td class="px-1 py-1 border border-gray-200 text-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor"
                                        [class.transform.rotate-90]="expandedRows.has(timesheet.user_id + '-' + timesheet.timesheet_date)">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 5l7 7-7 7" />
                                    </svg>
                                </td>
                                <td class="px-1 py-1 border border-gray-200 text-center">{{ timesheet.employee_name }}
                                </td>
                                <td class="px-1 py-1 border border-gray-200 text-center">{{ timesheet.timesheet_date |
                                    date:'dd-MMM-yyyy' }}</td>
                                <td class="px-1 py-1 border border-gray-200 text-center">
                                    <span class="truncate max-w-[150px] inline-block" [title]="timesheet.projects">
                                        {{ timesheet.projects || '-' }}
                                    </span>
                                </td>
                                <td class="px-1 py-1 border border-gray-200 text-center">
                                    <span [ngClass]="{
                                    'text-red-600': (timesheet.total_hours || 0) < 6,
                                    'text-orange-500': (timesheet.total_hours || 0) >= 6 && (timesheet.total_hours || 0) <= 8,
                                    'text-green-600': (timesheet.total_hours || 0) > 8
                                }">
                                        {{ timesheet.total_hours || 0 }}h
                                        {{ (timesheet.total_minutes || 0) % 60 }}m
                                    </span>
                                </td>
                                <td class="px-1 py-1 border border-gray-200 text-center">{{ timesheet.entry_count }}
                                </td>
                                <td class="px-1 py-1 border border-gray-200 text-center">
                                    <span [class.text-green-600]="timesheet.is_active_assignment"
                                        [class.text-orange-600]="!timesheet.is_active_assignment">
                                        {{ timesheet.is_active_assignment ? 'Active' : 'Released' }}
                                    </span>
                                </td>
                            </tr>

                            <!-- Detailed rows (shown when expanded) -->
                            <tr *ngIf="expandedRows.has(timesheet.user_id + '-' + timesheet.timesheet_date)"
                                class="bg-gray-50">
                                <td colspan="7" class="px-0 py-0 border border-gray-200">
                                    <table class="min-w-full text-xs bg-gray-50">
                                        <thead>
                                            <tr>
                                                <th class="px-1 py-1 border border-gray-200 text-center">Project</th>
                                                <th class="px-1 py-1 border border-gray-200 text-center">Task</th>
                                                <th class="px-1 py-1 border border-gray-200 text-center">Deliverable
                                                </th>
                                                <th class="px-1 py-1 border border-gray-200 text-center">Description
                                                </th>
                                                <th class="px-1 py-1 border border-gray-200 text-center">Hours</th>
                                                <th class="px-1 py-1 border border-gray-200 text-center">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let detail of getDetailedEntries(timesheet.user_id, timesheet.timesheet_date)"
                                                class="hover:bg-gray-100">
                                                <td class="px-1 py-1 border border-gray-200 text-center">{{
                                                    detail.project_name }}</td>
                                                <td class="px-1 py-1 border border-gray-200 text-center">{{
                                                    detail.task_name  }}</td>
                                                <td class="px-1 py-1 border border-gray-200 text-center">{{
                                                    detail.project_deliverable_name }}</td>
                                                <td class="px-1 py-1 border border-gray-200 text-center">
                                                    <div class="group relative inline-block">
                                                        <span class="truncate max-w-[100px] inline-block">{{
                                                            detail.task_description || '-' }}</span>
                                                        <div *ngIf="detail.task_description"
                                                            class="absolute z-20 hidden group-hover:block w-64 px-2 py-1 mb-2 text-xs text-gray-700 bg-white rounded shadow-lg border border-gray-300 whitespace-pre-wrap break-words">
                                                            {{ detail.task_description }}
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-1 py-1 border border-gray-200 text-center">
                                                    {{ detail.hours || 0 }}h {{ detail.minutes || 0 }}m
                                                </td>
                                                <td class="px-1 py-1 border border-gray-200 text-center">
                                                    <span [class.text-green-600]="detail.task_status"
                                                        [class.text-yellow-600]="!detail.task_status">
                                                        {{ detail.task_status ? 'Completed' : 'In Progress' }}
                                                    </span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
                <!-- Pagination Controls -->
                <div class="flex items-center justify-center mt-4 space-x-1">
                    <button (click)="changeTimesheetPage(timesheetCurrentPage - 1)"
                        [disabled]="timesheetCurrentPage === 1" class="px-3 py-1 border rounded-md">
                        Previous
                    </button>
                    <button *ngIf="timesheetCurrentPage > 3" (click)="changeTimesheetPage(1)"
                        class="px-3 py-1 border rounded-md">1</button>
                    <span *ngIf="timesheetCurrentPage > 4" class="px-2">...</span>
                    <button *ngFor="let page of getVisibleTimesheetPageNumbers()" (click)="changeTimesheetPage(page)"
                        [class.bg-blue-500]="timesheetCurrentPage === page" class="px-3 py-1 border rounded-md">{{ page
                        }}</button>
                    <span *ngIf="timesheetCurrentPage < timesheetTotalPages - 3" class="px-2">...</span>
                    <button *ngIf="timesheetCurrentPage < timesheetTotalPages - 2"
                        (click)="changeTimesheetPage(timesheetTotalPages)" class="px-3 py-1 border rounded-md">{{
                        timesheetTotalPages }}</button>
                    <button (click)="changeTimesheetPage(timesheetCurrentPage + 1)"
                        [disabled]="timesheetCurrentPage === timesheetTotalPages"
                        class="px-3 py-1 border rounded-md">Next</button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="selectedSection === 'viewMyReportingTeam'">
        <!-- My Reporting Team -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">
            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M12 6a2 2 0 100-4 2 2 0 000 4zm0 2a2 2 0 100 4 2 2 0 000-4zm0 6a2 2 0 100 4 2 2 0 000-4z"
                        clip-rule="evenodd" />
                </svg>
                My Reporting Team
            </h3>
            <p class="text-xs text-gray-500 mt-1">View your reporting team members</p>

            <!-- Team content would go here -->
        </div>
        <div class="rounded-lg w-full overflow-x-auto p-2 bg-white shadow-sm border border-gray-200">
            <div class="min-w-full relative ">
                <!-- Enhanced Filter Section -->
                <div class="flex flex-nowrap items-start gap-x-2 gap-y-2 mb-4 py-2 bg-gray-50 rounded shadow-sm w-full overflow-x-auto"
                    style="overflow: visible;">

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Customer</label>
                        <ng-select [(ngModel)]="reportingCustomerFilter" (change)="applyReportingFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Customers</ng-option>
                            <ng-option *ngFor="let customer of optionCustomers" [value]="customer.customer_name">
                                {{ customer.customer_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Project</label>
                        <ng-select [(ngModel)]="reportingProjectFilter" (change)="applyReportingFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Projects</ng-option>
                            <ng-option *ngFor="let project of optionProject" [value]="project.project_name">
                                {{ project.project_name }}
                            </ng-option>
                        </ng-select>
                    </div>


                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Reporting Manager</label>
                        <ng-select [(ngModel)]="reportingManagerFilter" (change)="applyReportingFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Managers</ng-option>
                            <ng-option *ngFor="let manager of optionReportingManagers"
                                [value]="manager.user_first_name + ' ' + manager.user_last_name">
                                {{ manager.user_first_name }} {{ manager.user_last_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Employee</label>
                        <ng-select [(ngModel)]="reportingEmployeeFilter" (change)="applyReportingFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Employees</ng-option>
                            <ng-option *ngFor="let user of optionUsers"
                                [value]="user.user_first_name + ' ' + user.user_last_name">
                                {{ user.user_first_name }} {{ user.user_last_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Project Role</label>
                        <ng-select [(ngModel)]="reportingRoleFilter" (change)="applyReportingFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Roles</ng-option>
                            <ng-option *ngFor="let role of optionProjectRole" [value]="role.project_role_name">
                                {{ role.project_role_name }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Allocation Status</label>
                        <ng-select [(ngModel)]="reportingAllocationStatusFilter" (change)="applyReportingFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true">
                            <ng-option [value]="null">All Statuses</ng-option>
                            <ng-option [value]="true">Active</ng-option>
                            <ng-option [value]="false">Inactive</ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Billed Status</label>
                        <ng-select [(ngModel)]="reportingBilledStatusFilter" (change)="applyReportingFilters()"
                            class="text-xs custom-ng-select-filter w-full" [clearable]="true">
                            <ng-option [value]="null">All Statuses</ng-option>
                            <ng-option [value]="true">Billed</ng-option>
                            <ng-option [value]="false">Not Billed</ng-option>
                        </ng-select>
                    </div>

                    <!-- Date Range Filters -->
                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">Start Date From</label>
                        <input type="date" [(ngModel)]="reportingStartDateFrom" (change)="applyReportingFilters()"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6">
                    </div>

                    <div class="relative w-48">
                        <label class="block text-xs font-medium mb-1">End Date </label>
                        <input type="date" [(ngModel)]="reportingEndtDate" (change)="applyReportingFilters()"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6">
                    </div>


                    <!-- Action Buttons -->
                    <!-- <button (click)="clearReportingFilters()"
                        class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none flex-grow-0">
                        Clear All
                    </button> -->
                    <div class="relative w-38">

                        <div class="h-[1.325rem]"></div> <!-- Exactly halfway between h-4 (1rem) and h-5 (1.25rem) -->

                        <button (click)="clearReportingFilters()" title="Clear all filters"
                            class="text-xs text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded px-2 py-1 h-6 flex items-center space-x-1 hover:bg-gray-50 transition-colors shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Reporting Team Table -->
            <div class="rounded-lg w-full inline-block whitespace-nowrap">
                <table class="min-w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-gray-100">
                            <th
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-200 text-center bg-gray-50">
                                #</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Customer Name</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Project Name</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Reporting Manager</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Employee Name</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Project Role</th>

                            <th class="px-1 py-1 border border-gray-200 text-center">Allocation Status</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Allocation %</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Status</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Start Date</th>
                            <th class="px-1 py-1 border border-gray-200 text-center">Tentative End Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let member of paginatedReportingTeamData; let i = index" class="hover:bg-gray-50">
                            <td
                                class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                                {{ (reportingCurrentPage - 1) * reportingItemsPerPage + i + 1 }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.customer_name }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.project_name }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.reporting_manager_name }}
                            </td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.employee_name }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.project_role_name }}</td>
                            <!-- <td class="px-1 py-1 border border-gray-300 text-center">{{ member.allocation_status ? 'Active' : 'Inactive' }}</td> -->
                            <td class="px-1 py-1 border border-gray-300 text-center">
                                <span [class.text-green-600]="member.allocation_status"
                                    [class.text-gray-500]="!member.allocation_status">
                                    {{ member.allocation_status ? 'Employee' : 'Shadow' }}
                                </span>
                            </td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.allocation_percentage }}%
                            </td>
                            <!-- <td class="px-1 py-1 border border-gray-300 text-center">{{ member.billed_status ? 'Billed' : 'Not Billed' }}</td> -->
                            <td class="px-1 py-1 border border-gray-300 text-center">
                                <span [class.text-green-600]="member.billed_status"
                                    [class.text-gray-500]="!member.billed_status">
                                    {{ member.billed_status ? 'Billed' : 'Not Billed' }}
                                </span>
                            </td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.start_date |
                                date:'dd-MMM-yyyy' }}</td>
                            <td class="px-1 py-1 border border-gray-300 text-center">{{ member.end_date |
                                date:'dd-MMM-yyyy' }}</td>
                        </tr>
                    </tbody>
                </table>

                <div class="flex items-center justify-center mt-4 space-x-1">
                    <button (click)="changeReportingPage(reportingCurrentPage - 1)"
                        [disabled]="reportingCurrentPage === 1" class="px-3 py-1 border rounded-md">
                        Previous
                    </button>
                    <button *ngIf="reportingCurrentPage > 3" (click)="changeReportingPage(1)"
                        class="px-3 py-1 border rounded-md">1</button>
                    <span *ngIf="reportingCurrentPage > 4" class="px-2">...</span>
                    <button *ngFor="let page of getVisibleReportingPageNumbers()" (click)="changeReportingPage(page)"
                        [class.bg-blue-500]="reportingCurrentPage === page" class="px-3 py-1 border rounded-md">{{ page
                        }}</button>
                    <span *ngIf="reportingCurrentPage < reportingTotalPages - 3" class="px-2">...</span>
                    <button *ngIf="reportingCurrentPage < reportingTotalPages - 2"
                        (click)="changeReportingPage(reportingTotalPages)" class="px-3 py-1 border rounded-md">{{
                        reportingTotalPages }}</button>
                    <button (click)="changeReportingPage(reportingCurrentPage + 1)"
                        [disabled]="reportingCurrentPage === reportingTotalPages"
                        class="px-3 py-1 border rounded-md">Next</button>
                </div>
            </div>
        </div>
    </div>


    <div *ngIf="selectedSection === 'viewMyReportingTeamsTimesheet'">
        <!-- My Reporting Team's Timesheet -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M12 6a2 2 0 100-4 2 2 0 000 4zm0 2a2 2 0 100 4 2 2 0 000-4zm0 6a2 2 0 100 4 2 2 0 000-4z"
                                clip-rule="evenodd" />
                        </svg>
                        My Reporting Team's Timesheet
                    </h3>
                    <p class="text-xs text-gray-500">View and manage your team's timesheet entries</p>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="text-center">
                        <div class="text-xs text-gray-500">Total Entries</div>
                        <div class="font-semibold">{{filteredReportingTimesheetData.length}}</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs text-gray-500">Total Hours</div>
                        <div class="font-semibold text-blue-600">
                            {{calculateFilteredTotalTime().hours}}h {{calculateFilteredTotalTime().minutes}}m
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timesheet content would go here -->
        </div>

        <div class="rounded-lg w-full overflow-x-auto p-2 bg-white shadow-sm border border-gray-200">
            <div class="min-w-full relative">
                <!-- Enhanced Filter Section -->
                <div class="flex flex-nowrap items-start gap-x-2 gap-y-2 mb-4 py-2 bg-gray-50 rounded shadow-sm w-full overflow-x-auto"
                    style="overflow: visible;">

                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Employee</label>
                        <ng-select [(ngModel)]="reportingTimesheetEmployeeFilter"
                            (change)="applyReportingTimesheetFilters()" class="text-xs custom-ng-select-filter w-full"
                            [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Employees</ng-option>
                            <ng-option *ngFor="let user of optionReportingTeamMembers" [value]="user.id">
                                {{ user.fullName }}
                            </ng-option>
                        </ng-select>
                    </div>

                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Project</label>
                        <ng-select [(ngModel)]="reportingTimesheetProjectFilter"
                            (change)="applyReportingTimesheetFilters()" class="text-xs custom-ng-select-filter w-full"
                            [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Projects</ng-option>
                            <ng-option *ngFor="let project of optionReportingProjects" [value]="project.id">
                                {{ project.name }}
                            </ng-option>
                        </ng-select>
                    </div>
                    <!-- <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Phase</label>
                        <ng-select [(ngModel)]="reportingTimesheetPhaseFilter"
                            (change)="applyReportingTimesheetFilters()" class="text-xs custom-ng-select-filter w-full"
                            [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Phases</ng-option>
                            <ng-option *ngFor="let phase of optionReportingPhases" [value]="phase.id">
                                {{ phase.name }}
                            </ng-option>
                        </ng-select>
                    </div> -->
                    <div class="relative w-full">
    <label class="block text-xs font-medium mb-1">Task</label>
    <ng-select [(ngModel)]="reportingTimesheetTaskFilter" 
               (change)="applyReportingTimesheetFilters()" 
               class="text-xs custom-ng-select-filter w-full" 
               [clearable]="true" [searchable]="true">
        <ng-option [value]="">All Tasks</ng-option>
        <ng-option *ngFor="let task of optionReportingTasks" [value]="task.id">
            {{ task.name }}
        </ng-option>
    </ng-select>
</div>

                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Deliverable</label>
                        <ng-select [(ngModel)]="reportingTimesheetDeliverableFilter"
                            (change)="applyReportingTimesheetFilters()" class="text-xs custom-ng-select-filter w-full"
                            [clearable]="true" [searchable]="true">
                            <ng-option [value]="">All Deliverables</ng-option>
                            <ng-option *ngFor="let deliverable of optionReportingDeliverables" [value]="deliverable.id">
                                {{ deliverable.name }}
                            </ng-option>
                        </ng-select>
                    </div>
                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Date</label>
                        <input type="date" [(ngModel)]="reportingTimesheetDateFilter"
                            (change)="applyReportingTimesheetFilters()"
                            class="text-xs border border-gray-300 rounded px-2 py-1 w-full h-6">
                    </div>

                    <div class="relative w-full">
                        <label class="block text-xs font-medium mb-1">Task Status</label>
                        <ng-select [(ngModel)]="reportingTimesheetStatusFilter"
                            (change)="applyReportingTimesheetFilters()" class="text-xs custom-ng-select-filter w-full"
                            [clearable]="true">
                            <ng-option [value]="">All Statuses</ng-option>
                            <ng-option [value]="1">Completed</ng-option>
                            <ng-option [value]="0">In Progress</ng-option>
                        </ng-select>
                    </div>

                    <!-- Clear Button -->
                    <!-- <button (click)="clearReportingTimesheetFilters()"
                        class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none flex-grow-0">
                        Clear All
                    </button> -->
                    <div class="relative w-28">

                        <div class="h-[1.325rem]"></div> <!-- Exactly halfway between h-4 (1rem) and h-5 (1.25rem) -->

                        <button (click)="clearReportingTimesheetFilters()" title="Clear all filters"
                            class="text-xs text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded px-2 py-1 h-6 flex items-center space-x-1 hover:bg-gray-50 transition-colors shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>Clear</span>
                        </button>
                    </div>
                </div>
                <!-- Add this right after the filter section and before the table -->



                <!-- Timesheet Table -->
                <div class="rounded-lg w-full inline-block whitespace-nowrap">
                    <table class="min-w-full text-xs border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th
                                    class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-200 text-center bg-gray-50">
                                    #</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Employee Name</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Project Name</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Task</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Deliverable</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Task Description</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Hours</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Minutes</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Status</th>
                                <th class="px-1 py-1 border border-gray-200 text-center">Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let timesheet of paginatedReportingTimesheetData; let i = index"
                                class="hover:bg-gray-50">
                                <td
                                    class="sticky left-0 px-1 py-1 border border-gray-300 border-b-gray-300 text-center bg-gray-50">
                                    {{ (reportingTimesheetCurrentPage - 1) *
                                    reportingTimesheetItemsPerPage + i + 1 }}</td>
                                <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.employee_name }}
                                </td>
                                <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.project_name }}
                                </td>
                                <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.task_name 
                                    }}</td>
                                <td class="px-1 py-1 border border-gray-300 text-center">{{
                                    timesheet.project_deliverable_name }}</td>
                                <!-- <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.task_description }}</td> -->

                                <td class="px-1 py-1 border border-gray-300 text-center">
                                    <div class="group relative inline-block">
                                        <span class="truncate max-w-[100px] inline-block">{{ timesheet.task_description
                                            || '-' }}</span>
                                        <div *ngIf="timesheet.task_description"
                                            class="absolute z-20 hidden group-hover:block w-64 px-2 py-1 mb-2 text-xs text-gray-700 bg-white rounded shadow-lg border border-gray-300 whitespace-pre-wrap break-words">
                                            {{ timesheet.task_description }}
                                        </div>
                                    </div>
                                </td>



                                <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.hours }}</td>
                                <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.minutes }}</td>
                                <!-- <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.task_status ? 'Completed' : 'In Progress' }}</td> -->
                                <td class="px-1 py-1 border border-gray-300 text-center">
                                    <span [class.text-green-600]="timesheet.task_status"
                                        [class.text-yellow-600]="!timesheet.task_status">
                                        {{ timesheet.task_status ? 'Completed' : 'In Progress' }}
                                    </span>
                                </td>
                                <td class="px-1 py-1 border border-gray-300 text-center">{{ timesheet.timesheet_date |
                                    date:'dd-MMM-yyyy' }}</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Pagination Controls -->
                    <div class="flex items-center justify-center mt-4 space-x-1">
                        <button (click)="changeReportingTimesheetPage(reportingTimesheetCurrentPage - 1)"
                            [disabled]="reportingTimesheetCurrentPage === 1" class="px-3 py-1 border rounded-md">
                            Previous
                        </button>
                        <button *ngIf="reportingTimesheetCurrentPage > 3" (click)="changeReportingTimesheetPage(1)"
                            class="px-3 py-1 border rounded-md">1</button>
                        <span *ngIf="reportingTimesheetCurrentPage > 4" class="px-2">...</span>
                        <button *ngFor="let page of getVisibleReportingTimesheetPageNumbers()"
                            (click)="changeReportingTimesheetPage(page)"
                            [class.bg-blue-500]="reportingTimesheetCurrentPage === page"
                            class="px-3 py-1 border rounded-md">{{ page }}</button>
                        <span *ngIf="reportingTimesheetCurrentPage < reportingTimesheetTotalPages - 3"
                            class="px-2">...</span>
                        <button *ngIf="reportingTimesheetCurrentPage < reportingTimesheetTotalPages - 2"
                            (click)="changeReportingTimesheetPage(reportingTimesheetTotalPages)"
                            class="px-3 py-1 border rounded-md">{{ reportingTimesheetTotalPages }}</button>
                        <button (click)="changeReportingTimesheetPage(reportingTimesheetCurrentPage + 1)"
                            [disabled]="reportingTimesheetCurrentPage === reportingTimesheetTotalPages"
                            class="px-3 py-1 border rounded-md">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <!-- Add this new section -->
    <div *ngIf="selectedSection === 'timesheetCalendarView'">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 m-4">
            <!-- Header Section (No changes needed here) -->
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                                clip-rule="evenodd" />
                        </svg>
                        Timesheet Calendar View
                    </h3>
                    <p class="text-xs text-gray-500">View team timesheets in monthly calendar format</p>
                </div>

                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-2">
                        <button (click)="previousMonth()" class="p-1 rounded-full hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <div class="text-center min-w-[120px]">
                            <div class="font-semibold">{{ currentMonth | date:'MMMM yyyy' }}</div>
                        </div>
                        <button (click)="nextMonth()" class="p-1 rounded-full hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>

                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="text-xs text-gray-500">Working Days</div>
                            <div class="font-semibold">{{ getWorkingDaysCount() }}</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500">Total Hours</div>
                            <div class="font-semibold text-blue-600">
                                {{ calculateTimesheetTotalTime().hours }}h {{ calculateTimesheetTotalTime().minutes }}m
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500">Team Members</div>
                            <div class="font-semibold">{{ calendarEmployees.length }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Grid -->
            <div *ngIf="calendarEmployees.length > 0 && calendarDays.length > 0; else noDataTemplate"
                class="overflow-x-auto pb-4">
                <table class="w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="sticky left-0 px-4 py-2 bg-gray-50 border border-gray-200 text-center z-10 w-40">
                                Employee
                            </th>
                            <th *ngFor="let day of calendarDays"
                                class="px-2 py-2 border border-gray-200 text-center whitespace-nowrap w-12"
                                [class.bg-blue-50]="isToday(day.date)" [class.text-blue-600]="isToday(day.date)">
                                {{ day.date | date:'dd' }}<br>
                                <span [class.font-bold]="isToday(day.date)">
                                    {{ day.date | date:'EEE' }}
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let employee of calendarEmployees" class="hover:bg-gray-50">
                            <td class="sticky left-0 px-4 py-2 bg-white border border-gray-200 z-10 w-40">
                                <div class="flex items-center">
                                    <span class="truncate">{{ employee.name }}</span>
                                </div>
                            </td>
                            <!-- MODIFIED: Added click handler and visual feedback for selected cells -->
                            <td *ngFor="let day of calendarDays"
                                class="px-2 py-2 border border-gray-200 text-center relative group cursor-pointer hover:bg-gray-50 transition-colors"
                                [class.bg-gray-100]="!day.isCurrentMonth" [class.text-gray-400]="!day.isCurrentMonth"
                                [class.bg-blue-50]="isToday(day.date)"
                                [class.bg-blue-100]="selectedCell && selectedCell.employeeId === employee.id && selectedCell.date.getTime() === day.date.getTime()"
                                (click)="onCellClick(employee.id, day.date)">
                                <div class="h-8 flex items-center justify-center">
                                    <span *ngIf="day.isCurrentMonth"
                                        [class.font-bold]="getHoursValue(employee.id, day.date) > 8"
                                        [class.text-green-600]="getHoursValue(employee.id, day.date) > 8"
                                        [class.text-orange-500]="getHoursValue(employee.id, day.date) <= 8 && getHoursValue(employee.id, day.date) >= 6"
                                        [class.text-red-600]="getHoursValue(employee.id, day.date) < 6">
                                        {{ getHoursForCell(employee.id, day.date) || '-' }}
                                    </span>
                                </div>
                                <div *ngIf="day.isCurrentMonth && getHoursForCell(employee.id, day.date)"
                                    class="absolute hidden group-hover:block bg-white p-2 border rounded shadow-lg z-20 min-w-[180px]">
                                    <div class="text-xs">
                                        <div class="font-semibold">{{ employee.name }}'s Timesheet</div>
                                        <div>Date: {{ day.date | date:'dd MMM yyyy' }}</div>
                                        <div>Total Hours: {{ getHoursForCell(employee.id, day.date) }}</div>
                                        <div>Entries: {{ getEntryCount(employee.id, day.date) }}</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- NEW: Added detailed entries panel that appears when a cell is clicked -->
            <div *ngIf="selectedCell" class="mt-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-semibold text-gray-800">
                        Timesheet Details for {{ getEmployeeName(selectedCell.employeeId) }} on {{ selectedCell.date |
                        date:'dd MMM yyyy' }}
                    </h4>
                    <button (click)="selectedCell = null; selectedEntries = []"
                        class="text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <div *ngIf="selectedEntries.length > 0; else noEntries" class="space-y-3">
                    <div *ngFor="let entry of selectedEntries"
                        class="p-3 bg-white rounded shadow-sm border border-gray-200">
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-3 text-xs">
                            <div>
                                <span class="font-medium text-gray-500">Project:</span>
                                <div class="font-semibold">{{ entry.project_name || '-' }}</div>
                            </div>
                            <div>
                                <span class="font-medium text-gray-500">Deliverable:</span>
                                <div>{{ entry.project_deliverable_name || '-' }}</div>
                            </div>
                            <div>
                                <span class="font-medium text-gray-500">Task:</span>
                                <div>{{ entry.project_phase_name || '-' }}</div>
                            </div>
                            <div>
                                <span class="font-medium text-gray-500">Hours:</span>
                                <div class="font-semibold">{{ entry.hours || 0 }}h {{ entry.minutes || 0 }}m</div>
                            </div>
                            <div>
                                <span class="font-medium text-gray-500">Status:</span>
                                <span [class.text-green-600]="entry.task_status"
                                    [class.text-yellow-600]="!entry.task_status" class="font-medium">
                                    {{ entry.task_status ? 'Completed' : 'In Progress' }}
                                </span>
                            </div>
                            <div class="md:col-span-4 pt-2 border-t border-gray-100">
                                <span class="font-medium text-gray-500">Description:</span>
                                <p class="mt-1 text-gray-800">{{ entry.task_description || 'No description provided' }}
                                </p>
                            </div>

                        </div>
                    </div>
                </div>

                <ng-template #noEntries>
                    <div class="text-center py-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto text-gray-400" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p class="mt-2 text-sm text-gray-500">No timesheet entries found for this day</p>
                    </div>
                </ng-template>
            </div>

            <!-- No Data Template (No changes needed here) -->
            <ng-template #noDataTemplate>
                <div class="text-center py-8">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h4 class="mt-2 text-lg font-medium text-gray-700">No Timesheet Data Available</h4>
                    <p class="mt-1 text-sm text-gray-500">There are no timesheet entries for {{ currentMonth |
                        date:'MMMM yyyy' }}.</p>

                </div>
            </ng-template>
        </div>
    </div>
</div>